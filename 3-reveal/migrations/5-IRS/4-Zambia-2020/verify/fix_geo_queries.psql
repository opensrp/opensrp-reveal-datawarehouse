-- Verify reveal_irs_zambia_2020:fix_geo_queries on pg

BEGIN;

SET search_path TO :"schema",public;

SELECT has_function_privilege(:'schema' || '.create_structure_geo_hierarchy(locations, BOOLEAN, INTEGER)', 'execute');

-- first some fixtures
INSERT INTO raw_jurisdictions
VALUES
('6af44acb-mosh-4981-ab68-f36f175f73d7', 0, '{}'),
('acdde6e5-mosh-49a9-a141-424a5862a5af', 0, '{}');

INSERT INTO jurisdictions
VALUES (
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    NOW(),
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    NULL,  -- no parent
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    'KTM_1901',
    'Active',
    ST_GeomFromGeoJSON('{"type":"MultiPolygon","coordinates":[[[[31.7840918594518,-14.3022604766396,0],[31.7841335655117,-14.3022709816204,0],[31.7841806836917,-14.302262594543,0],[31.7842804805598,-14.3022520113212,0],[31.784380799934,-14.3022484769856,0],[31.7844811202076,-14.3022520113212,0],[31.7845809170757,-14.302262594543,0],[31.7846796716296,-14.3022801726918,0],[31.784776866759,-14.3023046540365,0],[31.7848719979444,-14.3023359099742,0],[31.7849645678606,-14.3023737786269,0],[31.7850540944709,-14.3024180621438,0],[31.7851401101281,-14.3024685284997,0],[31.7852221678688,-14.3025249168913,0],[31.785299839616,-14.3025869314417,0],[31.7853727188759,-14.3026542501934,0],[31.7854404279335,-14.3027265215117,0],[31.7855026115564,-14.3028033676812,0],[31.7855589468879,-14.3028843903023,0],[31.7856091407493,-14.302969164895,0],[31.7856529296391,-14.3030572507914,0],[31.785690086928,-14.3031481875388,0],[31.7857204183626,-14.3032415020936,0],[31.7857437656623,-14.3033367070234,0],[31.7857600065191,-14.303433307701,0],[31.7857690572962,-14.3035307987074,0],[31.7857708703294,-14.303628672825,0],[31.7857654366256,-14.3037264183395,0],[31.7857527831645,-14.3038235280333,0],[31.785732977395,-14.3039194928903,0],[31.7857061218401,-14.3040138146857,0],[31.7856723567939,-14.3041060014907,0],[31.7856318576242,-14.3041955712686,0],[31.7855848356717,-14.3042820581704,0],[31.7855315373506,-14.3043650116359,0],[31.7854722396522,-14.3044439981919,0],[31.7854072510439,-14.3045186059489,0],[31.78533691057,-14.3045884463996,0],[31.7852615860534,-14.3046531562181,0],[31.7851816686991,-14.3047123963599,0],[31.7850975766918,-14.3047658601563,0],[31.7850097471022,-14.3048132661193,0],[31.7849186394837,-14.3048543696334,0],[31.7848247268797,-14.3048889548613,0],[31.7847284994207,-14.3049168419387,0],[31.7846304598279,-14.3049378851752,0],[31.784531118916,-14.3049519757531,0],[31.7844309937954,-14.3049590390284,0],[31.784330606972,-14.3049590390284,0],[31.7842304818513,-14.3049519757531,0],[31.7841311409395,-14.3049378851752,0],[31.7840406790341,-14.3049184688122,0],[31.7839433067383,-14.3049322797009,0],[31.7838431816176,-14.3049393429762,0],[31.7837427956935,-14.3049393429762,0],[31.7836426705728,-14.3049322797009,0],[31.7835433287617,-14.3049181891231,0],[31.7834513820757,-14.3048984535008,0],[31.7833761906587,-14.3048931492993,0],[31.7832768497469,-14.3048790587216,0],[31.783178810154,-14.304858015485,0],[31.7830825826951,-14.3048301284077,0],[31.7829886700911,-14.3047955431798,0],[31.7828975624726,-14.3047544405649,0],[31.7828097328829,-14.3047070337026,0],[31.7827256408757,-14.3046535708056,0],[31.7826457235214,-14.3045943297645,0],[31.7825703990048,-14.3045296208453,0],[31.7825000594303,-14.3044597794952,0],[31.7824350708219,-14.3043851717383,0],[31.7823757722242,-14.3043061851823,0],[31.7823224739031,-14.304223232616,0],[31.7822754519506,-14.3041367457142,0],[31.7822349536802,-14.3040471750371,0],[31.7822011877347,-14.3039549891314,0],[31.7821743321797,-14.3038606673359,0],[31.7821545264103,-14.3037647015797,0],[31.7821418738484,-14.3036675927851,0],[31.7821364392453,-14.3035698463713,0],[31.7821382522786,-14.3034719722536,0],[31.7821473030556,-14.3033744812473,0],[31.7821635439125,-14.303277881469,0],[31.7821868912121,-14.3031826756399,0],[31.7822172226468,-14.3030893610851,0],[31.7822543799358,-14.3029984243378,0],[31.7822981688255,-14.3029103384413,0],[31.7823483626868,-14.3028255638487,0],[31.7824046980185,-14.3027445421268,0],[31.7824668825406,-14.3026676950581,0],[31.7825345906988,-14.3025954246391,0],[31.7826074708581,-14.3025281058873,0],[31.782685141706,-14.302466091337,0],[31.7827671994468,-14.3024097029454,0],[31.7828532160032,-14.3023592356901,0],[31.7829427417142,-14.3023149521733,0],[31.7830353116304,-14.3022770844199,0],[31.7831304428157,-14.3022458275829,0],[31.7832276379452,-14.3022213471374,0],[31.7833263915998,-14.3022037689887,0],[31.7834261893672,-14.3021931848675,0],[31.7835265087414,-14.3021896514312,0],[31.783626829015,-14.3021931848675,0],[31.7837266258831,-14.3022037689887,0],[31.7838253795377,-14.3022213471374,0],[31.7838649613989,-14.3022313170216,0],[31.7838933089291,-14.3022323152691,0],[31.7839931057973,-14.3022428984909,0],[31.7840918594518,-14.3022604766396,0]]]]}'),
    4,
    NULL,
    NULL,
    0,
    1569929318864
);

INSERT INTO jurisdictions
VALUES (
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    NOW(),
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    NULL,  -- no parent
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    'NYJ_24',
    'Active',
    ST_GeomFromGeoJSON('{"type":"MultiPolygon","coordinates":[[[[31.8002001580109,-14.3303862763055,0],[31.8002973657309,-14.330410756751,0],[31.8003925086074,-14.3304420126887,0],[31.8004850902148,-14.3304798813414,0],[31.800574627617,-14.3305241648583,0],[31.800660654066,-14.3305746312142,0],[31.8007427225986,-14.3306310196058,0],[31.8008073047134,-14.3306825768394,0],[31.8008285745791,-14.3306787915929,0],[31.8009283849371,-14.3306682083711,0],[31.8010287169018,-14.3306646740354,0],[31.8011290497659,-14.3306682083711,0],[31.8012288592245,-14.3306787915929,0],[31.8013276254696,-14.3306963697416,0],[31.8014248331896,-14.3307208510864,0],[31.8015199760661,-14.3307521070241,0],[31.8016125576734,-14.3307899756768,0],[31.801702095975,-14.3308342582943,0],[31.8017881224239,-14.3308847255496,0],[31.8018701909566,-14.3309411130419,0],[31.801947871697,-14.3310031284915,0],[31.8020207608495,-14.331070446344,0],[31.8020884780009,-14.3311427176623,0],[31.8021506697177,-14.3312195638318,0],[31.8022070122439,-14.3313005855535,0],[31.8022572124005,-14.3313853601462,0],[31.8023010066862,-14.3314734451433,0],[31.8023381684717,-14.33156438279,0],[31.8023685035037,-14.3316576964455,0],[31.8023918535013,-14.3317529022746,0],[31.8024080970561,-14.3318495020528,0],[31.8024171487325,-14.3319469930593,0],[31.8024189617657,-14.3320448662775,0],[31.8024135271626,-14.3321426117921,0],[31.8024008728021,-14.3322397205866,0],[31.8023810643347,-14.3323356863428,0],[31.8023542051825,-14.3324300081383,0],[31.8023204356397,-14.332522194044,0],[31.8022799319733,-14.3326117638218,0],[31.8022329046249,-14.3326982507236,0],[31.8021795991093,-14.3327812032899,0],[31.8021202933169,-14.3328601898459,0],[31.8020552966147,-14.3329347976028,0],[31.801984948047,-14.3330046380536,0],[31.8019096136378,-14.3330693478721,0],[31.801829686391,-14.3331285880139,0],[31.8017455835919,-14.3331820509109,0],[31.8016577432103,-14.3332294568739,0],[31.8015666239006,-14.333270560388,0],[31.8014726996054,-14.333305145616,0],[31.8013764604553,-14.3333330326932,0],[31.801278408272,-14.3333540759298,0],[31.8011817545344,-14.3333677833965,0],[31.8011833688175,-14.3333773809613,0],[31.8012088852819,-14.3334398226896,0],[31.8012131111961,-14.3334373441581,0],[31.8013026494977,-14.3333930615405,0],[31.8013952329037,-14.3333551928878,0],[31.8014903766796,-14.3333239369501,0],[31.8015875852989,-14.3332994565047,0],[31.8016863524433,-14.3332818783559,0],[31.8017861637006,-14.3332712942348,0],[31.801886497464,-14.3332677607985,0],[31.8019868312273,-14.3332712942348,0],[31.8020866415853,-14.3332818783559,0],[31.8021854087297,-14.3332994565047,0],[31.8022545647964,-14.3333168718761,0],[31.8023359930117,-14.3333140039381,0],[31.8024363267751,-14.3333175382737,0],[31.8025361380324,-14.3333281214956,0],[31.8026349051768,-14.3333456996443,0],[31.8027321137961,-14.3333701800897,0],[31.8028272575719,-14.3334014369267,0],[31.8029198400786,-14.3334393046801,0],[31.8030093792795,-14.333483588197,0],[31.8030954075271,-14.3335340554523,0],[31.8031774760597,-14.3335904429445,0],[31.8032551585987,-14.3336524574948,0],[31.8033280477513,-14.3337197762467,0],[31.803395765802,-14.3337920466656,0],[31.8034579584181,-14.3338688937344,0],[31.8035143018436,-14.3339499154562,0],[31.8035645020002,-14.3340346900488,0],[31.8036082980846,-14.334122775046,0],[31.8036454598702,-14.3342137117933,0],[31.8036757949021,-14.3343070263481,0],[31.803699145799,-14.3344022312779,0],[31.8037153893538,-14.3344988310562,0],[31.8037244410302,-14.3345963220626,0],[31.8037262540634,-14.3346941952809,0],[31.8037208194603,-14.3347919416947,0],[31.8037081642005,-14.3348890504893,0],[31.8037072585832,-14.3348934409795,0],[31.8037215191329,-14.3349110613963,0],[31.8037778625584,-14.3349920831181,0],[31.803828062715,-14.3350768577108,0],[31.8038718587993,-14.3351649427079,0],[31.8039090205849,-14.3352558794552,0],[31.8039393565161,-14.3353491940101,0],[31.8039627065137,-14.3354443989398,0],[31.8039789500685,-14.335540998718,0],[31.8039880026442,-14.3356384897245,0],[31.8039898156775,-14.3357363629427,0],[31.8039843810744,-14.3358341093566,0],[31.8039717258146,-14.3359312181511,0],[31.8039519173471,-14.3360271830081,0],[31.8039250572956,-14.3361215048035,0],[31.8038912877528,-14.3362136907092,0],[31.8038521564519,-14.3363002243758,0],[31.8038226874671,-14.3363806696321,0],[31.8037821829014,-14.3364702394099,0],[31.8037351546537,-14.3365567263118,0],[31.8036818482387,-14.336639678878,0],[31.8036501525326,-14.3366818930549,0],[31.8036181825332,-14.3367525887609,0],[31.8035711542854,-14.3368390756627,0],[31.8035178478704,-14.336922028229,0],[31.8034585411788,-14.337001014785,0],[31.8033939725539,-14.3370751288141,0],[31.8034760069123,-14.3371086825196,0],[31.8035655470125,-14.3371529651372,0],[31.8036515770587,-14.3372034323925,0],[31.8037336473899,-14.3372598198847,0],[31.803811329929,-14.337321834435,0],[31.8038263414126,-14.3373356983838,0],[31.8039148077223,-14.3373718817069,0],[31.8040043478225,-14.3374161652238,0],[31.8040903778687,-14.337466632479,0],[31.8041724481999,-14.3375230199713,0],[31.8042501316383,-14.3375850345217,0],[31.8043230225895,-14.3376523532734,0],[31.8043907415395,-14.3377246236924,0],[31.8044529350549,-14.3378014707612,0],[31.8045092793798,-14.337882492483,0],[31.8045594804357,-14.3379672670757,0],[31.80460327652,-14.3380553520728,0],[31.8046404401043,-14.3381462888201,0],[31.8046707760356,-14.338239603375,0],[31.8046941260332,-14.3383348083047,0],[31.8047103704873,-14.338431408083,0],[31.8047194221637,-14.3385288990894,0],[31.8047212351969,-14.3386267723076,0],[31.8047158005938,-14.3387245178222,0],[31.8047031453339,-14.3388216266167,0],[31.8046833359672,-14.3389175923729,0],[31.804656476815,-14.3390119141685,0],[31.8046227063729,-14.3391041000741,0],[31.8045822009079,-14.3391936698519,0],[31.8045351726602,-14.3392801567538,0],[31.8045234850708,-14.3392983446428,0],[31.8045594372683,-14.3393500421707,0],[31.8046096383242,-14.3394348167633,0],[31.8046534353078,-14.3395229017605,0],[31.8046905979928,-14.3396138385078,0],[31.804720933924,-14.3397071530626,0],[31.8047442848209,-14.3398023579924,0],[31.804760529275,-14.3398989577706,0],[31.8047695809515,-14.3399964487771,0],[31.804771394884,-14.3400943219953,0],[31.8047659593816,-14.3401920684092,0],[31.8047533041217,-14.3402891772037,0],[31.8047334947551,-14.3403851420606,0],[31.8047066356028,-14.3404794638561,0],[31.8046767682183,-14.3405609918962,0],[31.8046847892717,-14.3406086883402,0],[31.8046938409481,-14.3407061793466,0],[31.8046956539813,-14.3408040525649,0],[31.8046902193782,-14.3409017989788,0],[31.8046775641183,-14.3409989077733,0],[31.8046577547516,-14.3410948726302,0],[31.8046308947001,-14.3411891944257,0],[31.8046117220534,-14.3412415313715,0],[31.8046771324438,-14.3412091827576,0],[31.8047697185477,-14.3411713141048,0],[31.8048648650216,-14.3411400581671,0],[31.8049620781375,-14.3411155768223,0],[31.8050608488791,-14.341097999573,0],[31.8051606628344,-14.3410874154518,0],[31.8052610001951,-14.3410838811162,0],[31.8053613375557,-14.3410874154518,0],[31.805461151511,-14.341097999573,0],[31.8055599222527,-14.3411155768223,0],[31.8056571344692,-14.3411400581671,0],[31.8057522818424,-14.3411713141048,0],[31.8058448679463,-14.3412091827576,0],[31.8059344098452,-14.3412534653751,0],[31.8060204407907,-14.3413039326304,0],[31.8061025120214,-14.3413603201226,0],[31.8061801972584,-14.341422334673,0],[31.8062530891088,-14.3414896534247,0],[31.8063208089582,-14.3415619238436,0],[31.8063830042723,-14.3416387709125,0],[31.8064393494964,-14.3417197926343,0],[31.8064895514517,-14.341804567227,0],[31.8065333484353,-14.3418926522241,0],[31.8065705120196,-14.3419835889714,0],[31.8066008488502,-14.3420769035262,0],[31.8066241997471,-14.342172108456,0],[31.8066404433019,-14.3422687082343,0],[31.8066494958776,-14.3423661992406,0],[31.8066513089108,-14.3424640724589,0],[31.8066458743077,-14.3425618179735,0],[31.8066332190479,-14.342658926768,0],[31.8066134096812,-14.3427548925242,0],[31.8066104679987,-14.3427652212379,0],[31.8066078923404,-14.3427849883365,0],[31.8065880829737,-14.3428809531934,0],[31.8065612229221,-14.3429752749889,0],[31.8065274515807,-14.3430674608945,0],[31.8064869452164,-14.3431570306724,0],[31.8064399160693,-14.3432435175743,0],[31.8063866078557,-14.3433264701404,0],[31.8063273002647,-14.3434054566964,0],[31.806278998577,-14.3434608981019,0],[31.8062446660585,-14.3435066214334,0],[31.806179665759,-14.3435812291903,0],[31.8061588176753,-14.3436019261879,0],[31.8061264780546,-14.3436449947207,0],[31.8060614786544,-14.3437196024776,0],[31.8059911264893,-14.3437894438277,0],[31.8059157884829,-14.3438541527469,0],[31.8058358576388,-14.3439133928887,0],[31.8057565239445,-14.3439638214732,0],[31.8057610538296,-14.3439777546696,0],[31.8057844047265,-14.3440729595994,0],[31.8058006491806,-14.3441695593776,0],[31.8058097017564,-14.344267050384,0],[31.8058115147896,-14.3443649236023,0],[31.8058060801865,-14.3444626691169,0],[31.8057934240273,-14.3445597779114,0],[31.8057736146607,-14.3446557436676,0],[31.8057467546091,-14.3447500645638,0],[31.8057129832676,-14.3448422504694,0],[31.8056724769033,-14.3449318202473,0],[31.8056254468569,-14.3450183071491,0],[31.8055721386434,-14.3451012597153,0],[31.8055228917681,-14.3451668463728,0],[31.8055606030395,-14.3452210718949,0],[31.805610805894,-14.3453058464876,0],[31.8056546028777,-14.345393932384,0],[31.8056917673612,-14.3454848691314,0],[31.8057221041918,-14.3455781827869,0],[31.8057454559881,-14.3456733877166,0],[31.8057616995429,-14.3457699874949,0],[31.8057707521186,-14.3458674785013,0],[31.8057725660511,-14.3459653517195,0],[31.8057671305487,-14.3460630981334,0],[31.8057544752888,-14.3461602069279,0],[31.8057346650228,-14.3462561717848,0],[31.8057078049713,-14.3463504935804,0],[31.8056740327305,-14.346442679486,0],[31.8056335263662,-14.3465322492639,0],[31.8055864963198,-14.3466187352664,0],[31.8055331881062,-14.3467016887319,0],[31.8054738787166,-14.3467806743886,0],[31.8054088775177,-14.3468552821455,0],[31.8053385244534,-14.3469251225963,0],[31.8052631855476,-14.3469898324148,0],[31.8051832538042,-14.3470490725566,0],[31.8050991456091,-14.3471025354536,0],[31.8050112998317,-14.3471499414166,0],[31.8049201742267,-14.3471910449308,0],[31.8048262445356,-14.3472256301587,0],[31.8047299999895,-14.3472535163367,0],[31.8046319415109,-14.3472745604726,0],[31.8045325817133,-14.347288650151,0],[31.8044324377069,-14.3472957134264,0],[31.8043320319977,-14.3472957134264,0],[31.8042318879913,-14.347288650151,0],[31.8041325281937,-14.3472745604726,0],[31.8040344706144,-14.3472535163367,0],[31.803938225169,-14.3472256301587,0],[31.8038442954779,-14.3471910449308,0],[31.8037531698729,-14.3471499414166,0],[31.8036653240955,-14.3471025354536,0],[31.8035812159005,-14.3470490725566,0],[31.803501284157,-14.3469898324148,0],[31.8034259452512,-14.3469251225963,0],[31.8033555921869,-14.3468552821455,0],[31.8032905918873,-14.3467806743886,0],[31.8032312824977,-14.3467016887319,0],[31.8031835824564,-14.3466274631868,0],[31.8031472417518,-14.346624900119,0],[31.8030478819542,-14.3466108104405,0],[31.8029498243749,-14.346589767204,0],[31.8028535798289,-14.3465618801266,0],[31.8027596501378,-14.3465272948987,0],[31.8026685245328,-14.3464861922839,0],[31.8025806787554,-14.3464387854216,0],[31.8024965714596,-14.3463853225246,0],[31.8024166397162,-14.3463260823827,0],[31.8023413008104,-14.3462613734636,0],[31.8022785470174,-14.3461990756268,0],[31.8022759686611,-14.3461968614959,0],[31.8022056155967,-14.3461270210452,0],[31.8021406152972,-14.3460524132882,0],[31.8020915428904,-14.3459870595551,0],[31.8020745115296,-14.3459701523007,0],[31.8020095103307,-14.3458955445437,0],[31.8019502018404,-14.345816558887,0],[31.8018968936268,-14.3457336063208,0],[31.8018498635804,-14.345647119419,0],[31.8018093572161,-14.3455575496412,0],[31.8017755858746,-14.3454653637355,0],[31.8017487249238,-14.34537104194,0],[31.8017289155571,-14.3452750770831,0],[31.8017162602972,-14.3451779682886,0],[31.8017108247948,-14.3450802218747,0],[31.801712637828,-14.3449823486564,0],[31.8017136693504,-14.3449712384319,0],[31.8017105469042,-14.3449561109357,0],[31.8017030654441,-14.344939568806,0],[31.8016692941027,-14.3448473829004,0],[31.8016424331518,-14.3447530611048,0],[31.8016226237851,-14.3446570962479,0],[31.8016174679718,-14.3446175350712,0],[31.8015585902568,-14.3445499537173,0],[31.8014992808672,-14.3444709671614,0],[31.8014459726535,-14.3443880145952,0],[31.8013989435065,-14.3443015276933,0],[31.8013699619542,-14.3442374429036,0],[31.8013245785665,-14.3441770012676,0],[31.8012712703529,-14.3440940487013,0],[31.8012242403065,-14.3440075617995,0],[31.8011837348415,-14.3439179920217,0],[31.8011499635001,-14.343825806116,0],[31.8011231034485,-14.3437314852198,0],[31.8011141695833,-14.3436882080443,0],[31.8010966669776,-14.3436770825313,0],[31.8010167361335,-14.3436178423894,0],[31.8009413990264,-14.3435531334703,0],[31.8009133069036,-14.3435252454937,0],[31.8008826840887,-14.3435114328063,0],[31.8008795409581,-14.343509736685,0],[31.800840082304,-14.3435969916079,0],[31.8007930522576,-14.3436834785097,0],[31.8007397449433,-14.3437664310759,0],[31.800680436453,-14.3438454176319,0],[31.8006154361535,-14.3439200253888,0],[31.8005450839885,-14.3439898658396,0],[31.8004697459821,-14.3440545756581,0],[31.8003898151379,-14.3441138157999,0],[31.8003057087415,-14.3441672786969,0],[31.8002178638634,-14.3442146846599,0],[31.8001267391577,-14.3442557881741,0],[31.800032810366,-14.344290373402,0],[31.7999365667192,-14.3443182595799,0],[31.7998385100393,-14.3443393037159,0],[31.799739151141,-14.3443533933943,0],[31.7996390089332,-14.3443604566697,0],[31.7995386050226,-14.3443604566697,0],[31.7994384619155,-14.3443533933943,0],[31.7993391039166,-14.3443393037159,0],[31.7992410463373,-14.3443182595799,0],[31.7992275942781,-14.3443143619182,0],[31.7992185057295,-14.3443137207016,0],[31.7991191468312,-14.3442996310231,0],[31.7990210901513,-14.3442785868872,0],[31.7989248465045,-14.3442507007092,0],[31.7988309177127,-14.3442161154813,0],[31.7987397930071,-14.3441750119672,0],[31.7986519490283,-14.3441276060042,0],[31.7985678417326,-14.3440741431072,0],[31.7984879108884,-14.3440149029653,0],[31.798412572882,-14.3439501931468,0],[31.798342220717,-14.3438803526961,0],[31.7982772213168,-14.3438057449391,0],[31.7982179128265,-14.3437267583831,0],[31.7981646046129,-14.343643805817,0],[31.7981175745664,-14.3435573198144,0],[31.7981084824206,-14.3435372136714,0],[31.7981021889649,-14.3435299903168,0],[31.7980428804746,-14.3434510037608,0],[31.797989572261,-14.3433680511945,0],[31.7979425431139,-14.3432815642927,0],[31.7979020367496,-14.3431919945149,0],[31.7978682663075,-14.3430998086092,0],[31.7978414053566,-14.3430054868137,0],[31.7978215959899,-14.3429095219568,0],[31.7978089407301,-14.3428124131623,0],[31.797803506127,-14.3427146676477,0],[31.7978053191602,-14.3426167935302,0],[31.7978143717359,-14.342519303423,0],[31.7978306152907,-14.3424227036448,0],[31.7978539661876,-14.3423274978157,0],[31.7978843030182,-14.3422341841602,0],[31.7979214666025,-14.3421432474129,0],[31.7979652635861,-14.3420551615164,0],[31.7980154655414,-14.3419703869238,0],[31.7980718107655,-14.341889365202,0],[31.7981340060796,-14.3418125190325,0],[31.7982017259289,-14.3417402486135,0],[31.7982746186788,-14.3416729298618,0],[31.7983523030164,-14.3416109153114,0],[31.7984343751464,-14.3415545278191,0],[31.7985204060919,-14.3415040605639,0],[31.7986099479908,-14.341459777047,0],[31.7987025340947,-14.3414219092936,0],[31.7987976814679,-14.3413906533559,0],[31.7988948936845,-14.3413661720112,0],[31.7989936644261,-14.3413485938624,0],[31.7990934792807,-14.3413380106406,0],[31.7991938166414,-14.341334476305,0],[31.7992286527801,-14.3413357029802,0],[31.7992059493951,-14.3413096433254,0],[31.7991466418041,-14.3412306567694,0],[31.7990933344898,-14.3411477042031,0],[31.7990463053428,-14.3410612173013,0],[31.7990057998778,-14.3409716475235,0],[31.7989720294357,-14.3408794616178,0],[31.7989451693841,-14.3407851398223,0],[31.7989253600174,-14.3406891749654,0],[31.7989127047576,-14.3405920661709,0],[31.7989072692551,-14.340494319757,0],[31.7989090831877,-14.3403964465387,0],[31.7989181348641,-14.3402989555323,0],[31.7989343793182,-14.3402023557541,0],[31.7989577302151,-14.3401071508243,0],[31.7989880661464,-14.3400138362695,0],[31.7990218680648,-14.3399311256209,0],[31.7990217853272,-14.3399308360392,0],[31.7990019759605,-14.339834870283,0],[31.7989893207006,-14.3397377614884,0],[31.7989838860975,-14.3396400159739,0],[31.7989856991308,-14.3395421427556,0],[31.7989947517065,-14.3394446517493,0],[31.7990109952613,-14.339348051971,0],[31.7990343461582,-14.3392528470412,0],[31.7990646820895,-14.3391595324864,0],[31.7991018447744,-14.339068595739,0],[31.799145641758,-14.3389805107419,0],[31.799195842814,-14.3388957361493,0],[31.7992521871388,-14.3388147144275,0],[31.7992698759041,-14.3387928582038,0],[31.7992817766327,-14.3387562521992,0],[31.7993189393176,-14.3386653154519,0],[31.7993623397003,-14.3385780263548,0],[31.7993262031418,-14.3385115700528,0],[31.7992856976769,-14.3384219993757,0],[31.7992519272347,-14.3383298134701,0],[31.7992250680825,-14.3382354925739,0],[31.7992052587157,-14.3381395268177,0],[31.7992011910821,-14.3381083149467,0],[31.7991405120251,-14.3380907323014,0],[31.7990465850319,-14.3380561470735,0],[31.7989554639236,-14.3380150444587,0],[31.7988676217434,-14.3379676375964,0],[31.7987835171456,-14.3379141746993,0],[31.7987035881002,-14.3378549345575,0],[31.7986282527917,-14.337790224739,0],[31.7985579024253,-14.3377203842883,0],[31.7984929039245,-14.3376457765313,0],[31.7984335972328,-14.3375667899753,0],[31.7983802908178,-14.3374838374091,0],[31.7983332625701,-14.3373973505073,0],[31.7982927571051,-14.3373077807295,0],[31.7982589875623,-14.3372155948238,0],[31.7982321275107,-14.3371212730283,0],[31.7982123190433,-14.3370253081714,0],[31.7981996637835,-14.3369281993769,0],[31.7981991835455,-14.3369195667846,0],[31.7981571240521,-14.3368778121613,0],[31.7980921264505,-14.336803203505,0],[31.7980328197589,-14.3367242178483,0],[31.7979795133439,-14.3366412652821,0],[31.7979324850962,-14.3365547783803,0],[31.7978919805306,-14.3364652086025,0],[31.7978582100884,-14.3363730226968,0],[31.7978313509361,-14.3362787009013,0],[31.7978115424688,-14.3361827351451,0],[31.797798887209,-14.3360856263506,0],[31.7977934526058,-14.335987880836,0],[31.797795265639,-14.3358900076177,0],[31.7978011445073,-14.3358266845538,0],[31.7977982244086,-14.3358245198856,0],[31.7977228891001,-14.3357598100671,0],[31.7976525396331,-14.3356899696163,0],[31.7975911761919,-14.3356195338144,0],[31.7975767537642,-14.3356164383479,0],[31.7974805137148,-14.3355885512706,0],[31.7973865885203,-14.3355539660427,0],[31.797295467412,-14.3355128634279,0],[31.7972076261311,-14.3354654565655,0],[31.7971235224327,-14.3354119936685,0],[31.7970435942865,-14.3353527535267,0],[31.7969682598774,-14.3352880446075,0],[31.7968979104103,-14.3352182032575,0],[31.7968329128087,-14.3351435955005,0],[31.7967736070164,-14.3350646089445,0],[31.7967203006015,-14.3349816563783,0],[31.796673273253,-14.3348951694765,0],[31.7966327686874,-14.3348055996986,0],[31.7965989982452,-14.3347134137929,0],[31.796572139093,-14.3346190919975,0],[31.7965523306256,-14.3345231271406,0],[31.7965396762651,-14.3344260183461,0],[31.7965342407626,-14.3343282719322,0],[31.7965360537959,-14.3342303987139,0],[31.7965451063716,-14.3341329077075,0],[31.7965613499264,-14.3340363079292,0],[31.796584699924,-14.3339411029995,0],[31.7966150349559,-14.3338477884446,0],[31.7966521976409,-14.3337568516973,0],[31.7966959928258,-14.3336687667002,0],[31.7967461929825,-14.3335839921075,0],[31.796802536408,-14.3335029703857,0],[31.7968647290241,-14.3334261233169,0],[31.7969061751799,-14.3333818901621,0],[31.7969679792889,-14.3333055233312,0],[31.7970356973396,-14.3332332529122,0],[31.7971085864921,-14.3331659341605,0],[31.7971862681318,-14.3331039196102,0],[31.7972683375638,-14.3330475321179,0],[31.7973543649121,-14.3329970648626,0],[31.7973643177091,-14.332992142873,0],[31.7973654553516,-14.3329875032706,0],[31.7973957903835,-14.3328941887158,0],[31.7974329530684,-14.3328032519685,0],[31.7974767482534,-14.332715166072,0],[31.7974793616833,-14.3327107530988,0],[31.7974927921587,-14.332669438244,0],[31.7975299539443,-14.3325785014966,0],[31.7975737491292,-14.3324904164995,0],[31.7976239492859,-14.3324056419068,0],[31.7976802918121,-14.332324620185,0],[31.7976902059383,-14.3323123696201,0],[31.7976913831509,-14.3322488343162,0],[31.7977004348273,-14.3321513433098,0],[31.7977166783821,-14.3320547435316,0],[31.7977400283797,-14.3319595386018,0],[31.7977521368517,-14.3319222904813,0],[31.7977440303628,-14.3318600807781,0],[31.7977385948603,-14.3317623343642,0],[31.7977404078936,-14.3316644611459,0],[31.7977494604693,-14.3315669701395,0],[31.7977657031248,-14.3314703703613,0],[31.7977890531224,-14.3313751654315,0],[31.7978193881543,-14.3312818508767,0],[31.7978565499399,-14.3311909141294,0],[31.7979003451249,-14.3311028282329,0],[31.7979505443822,-14.3310180536402,0],[31.7980068869084,-14.3309370319184,0],[31.7980690795245,-14.3308601857489,0],[31.7981367957765,-14.3307879144307,0],[31.7982096849291,-14.3307205965782,0],[31.7982873656695,-14.3306585820279,0],[31.7983694342021,-14.3306021936363,0],[31.798455460651,-14.330551726381,0],[31.7985449980533,-14.3305074437635,0],[31.7986375796606,-14.3304695751108,0],[31.7987327225372,-14.330438319173,0],[31.7988299302571,-14.3304138378283,0],[31.7989286965022,-14.3303962605789,0],[31.7990285059608,-14.3303856764578,0],[31.7991288379256,-14.3303821421221,0],[31.7992291707897,-14.3303856764578,0],[31.7993289802483,-14.3303962605789,0],[31.7993518805849,-14.3304003363064,0],[31.7993842345948,-14.3303897072192,0],[31.7994814423147,-14.3303652258744,0],[31.7995802076605,-14.3303476477257,0],[31.7996800171192,-14.3303370645039,0],[31.7997803499832,-14.3303335301682,0],[31.7998806828473,-14.3303370645039,0],[31.7999804923059,-14.3303476477257,0],[31.8000792576516,-14.3303652258744,0],[31.8000869747341,-14.3303671693094,0],[31.8001013917658,-14.3303686981569,0],[31.8002001580109,-14.3303862763055,0]]]]}'),
    4,
    NULL,
    NULL,
    0,
    1569929742260
);

INSERT INTO raw_locations
VALUES
('0006b3dc-mosh-420e-970b-5b69597d80b2', 0, '{}'),
('023bd6d7-mosh-4194-907a-2f5c3bfcf4bb', 0, '{}');

INSERT INTO locations
VALUES (
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    NOW(),
    '8405b2e8-6feb-4f85-bcff-b3cb5aa57ce3',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Residential Structure',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Pending Review',
    ST_GeomFromGeoJSON('{"type":"Point","coordinates":[31.7841588,-14.3052436]}'),
    0,
    NULL,
    NULL,
    0,
    1572378324112
);

INSERT INTO locations
VALUES (
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    NOW(),
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '622574979',
    'Active',
    ST_GeomFromGeoJSON('{"type":"Polygon","coordinates":[[[31.8008263001936,-14.3355217001663,0],[31.8008654000183,-14.3355284001155,0],[31.8008567998015,-14.3355756001338,0],[31.8008176999769,-14.3355690000093,0],[31.8008263001936,-14.3355217001663,0]]]}'),
    5,
    NULL,
    NULL,
    0,
    1570473981872
);

-- next lets run the function
SELECT create_structure_geo_hierarchy(locations.*, FALSE) FROM locations;

-- this structure is in the right jurisdiction
SELECT 1/COUNT(*)
FROM structure_geo_hierarchy
WHERE
id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb'
AND jurisdiction_id = 'acdde6e5-mosh-49a9-a141-424a5862a5af'
AND jurisdiction_depth = 4
AND geo_jurisdiction_id = 'acdde6e5-mosh-49a9-a141-424a5862a5af'
AND geo_jurisdiction_depth = 4
AND geo_strict_within = 'True';

-- this structure was moved to the right jurisdiction
SELECT 1/COUNT(*)
FROM structure_geo_hierarchy
WHERE
id = '0006b3dc-mosh-420e-970b-5b69597d80b2'
AND jurisdiction_id = 'acdde6e5-mosh-49a9-a141-424a5862a5af'
AND jurisdiction_depth = 4
AND geo_jurisdiction_id = '6af44acb-mosh-4981-ab68-f36f175f73d7'
AND geo_jurisdiction_depth = 4
AND geo_strict_within = 'False';

-- what happens when we process a structure with no jurisdiction
INSERT INTO raw_locations
VALUES
('023bd6d7-mosh-4194-133a-2f5c3bfcf4bb', 0, '{}');
INSERT INTO locations
VALUES (
    '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb',
    NOW(),
    '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb',
    '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb',
    '622574979',
    'Active',
    public.ST_GeomFromGeoJSON('{"type":"Polygon","coordinates":[[[[5.1325511, 12.6921346], [5.1326329, 12.6921471], [5.1326411, 12.6920956], [5.1325593, 12.6920831], [5.1325511, 12.6921346]]]]}'),
    5,
    NULL,
    NULL,
    0,
    1570473981872
);
INSERT INTO structure_geo_hierarchy_structure_queue
VALUES
(public.uuid_generate_v1(), '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb');
SELECT create_structure_geo_hierarchy(locations.*, FALSE) FROM locations;

ROLLBACK;

BEGIN;

SET search_path TO :"schema",public;

SELECT has_function_privilege(:'schema' || '.process_structure_geo_hierarchy_structure_queue(INTEGER, BOOLEAN, INTEGER)', 'execute');

-- first some fixtures
INSERT INTO raw_jurisdictions
VALUES
('6af44acb-mosh-4981-ab68-f36f175f73d7', 0, '{}'),
('acdde6e5-mosh-49a9-a141-424a5862a5af', 0, '{}');

INSERT INTO jurisdictions
VALUES (
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    NOW(),
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    NULL,  -- no parent
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    'KTM_1901',
    'Active',
    public.ST_GeomFromGeoJSON('{"type":"MultiPolygon","coordinates":[[[[31.7840918594518,-14.3022604766396,0],[31.7841335655117,-14.3022709816204,0],[31.7841806836917,-14.302262594543,0],[31.7842804805598,-14.3022520113212,0],[31.784380799934,-14.3022484769856,0],[31.7844811202076,-14.3022520113212,0],[31.7845809170757,-14.302262594543,0],[31.7846796716296,-14.3022801726918,0],[31.784776866759,-14.3023046540365,0],[31.7848719979444,-14.3023359099742,0],[31.7849645678606,-14.3023737786269,0],[31.7850540944709,-14.3024180621438,0],[31.7851401101281,-14.3024685284997,0],[31.7852221678688,-14.3025249168913,0],[31.785299839616,-14.3025869314417,0],[31.7853727188759,-14.3026542501934,0],[31.7854404279335,-14.3027265215117,0],[31.7855026115564,-14.3028033676812,0],[31.7855589468879,-14.3028843903023,0],[31.7856091407493,-14.302969164895,0],[31.7856529296391,-14.3030572507914,0],[31.785690086928,-14.3031481875388,0],[31.7857204183626,-14.3032415020936,0],[31.7857437656623,-14.3033367070234,0],[31.7857600065191,-14.303433307701,0],[31.7857690572962,-14.3035307987074,0],[31.7857708703294,-14.303628672825,0],[31.7857654366256,-14.3037264183395,0],[31.7857527831645,-14.3038235280333,0],[31.785732977395,-14.3039194928903,0],[31.7857061218401,-14.3040138146857,0],[31.7856723567939,-14.3041060014907,0],[31.7856318576242,-14.3041955712686,0],[31.7855848356717,-14.3042820581704,0],[31.7855315373506,-14.3043650116359,0],[31.7854722396522,-14.3044439981919,0],[31.7854072510439,-14.3045186059489,0],[31.78533691057,-14.3045884463996,0],[31.7852615860534,-14.3046531562181,0],[31.7851816686991,-14.3047123963599,0],[31.7850975766918,-14.3047658601563,0],[31.7850097471022,-14.3048132661193,0],[31.7849186394837,-14.3048543696334,0],[31.7848247268797,-14.3048889548613,0],[31.7847284994207,-14.3049168419387,0],[31.7846304598279,-14.3049378851752,0],[31.784531118916,-14.3049519757531,0],[31.7844309937954,-14.3049590390284,0],[31.784330606972,-14.3049590390284,0],[31.7842304818513,-14.3049519757531,0],[31.7841311409395,-14.3049378851752,0],[31.7840406790341,-14.3049184688122,0],[31.7839433067383,-14.3049322797009,0],[31.7838431816176,-14.3049393429762,0],[31.7837427956935,-14.3049393429762,0],[31.7836426705728,-14.3049322797009,0],[31.7835433287617,-14.3049181891231,0],[31.7834513820757,-14.3048984535008,0],[31.7833761906587,-14.3048931492993,0],[31.7832768497469,-14.3048790587216,0],[31.783178810154,-14.304858015485,0],[31.7830825826951,-14.3048301284077,0],[31.7829886700911,-14.3047955431798,0],[31.7828975624726,-14.3047544405649,0],[31.7828097328829,-14.3047070337026,0],[31.7827256408757,-14.3046535708056,0],[31.7826457235214,-14.3045943297645,0],[31.7825703990048,-14.3045296208453,0],[31.7825000594303,-14.3044597794952,0],[31.7824350708219,-14.3043851717383,0],[31.7823757722242,-14.3043061851823,0],[31.7823224739031,-14.304223232616,0],[31.7822754519506,-14.3041367457142,0],[31.7822349536802,-14.3040471750371,0],[31.7822011877347,-14.3039549891314,0],[31.7821743321797,-14.3038606673359,0],[31.7821545264103,-14.3037647015797,0],[31.7821418738484,-14.3036675927851,0],[31.7821364392453,-14.3035698463713,0],[31.7821382522786,-14.3034719722536,0],[31.7821473030556,-14.3033744812473,0],[31.7821635439125,-14.303277881469,0],[31.7821868912121,-14.3031826756399,0],[31.7822172226468,-14.3030893610851,0],[31.7822543799358,-14.3029984243378,0],[31.7822981688255,-14.3029103384413,0],[31.7823483626868,-14.3028255638487,0],[31.7824046980185,-14.3027445421268,0],[31.7824668825406,-14.3026676950581,0],[31.7825345906988,-14.3025954246391,0],[31.7826074708581,-14.3025281058873,0],[31.782685141706,-14.302466091337,0],[31.7827671994468,-14.3024097029454,0],[31.7828532160032,-14.3023592356901,0],[31.7829427417142,-14.3023149521733,0],[31.7830353116304,-14.3022770844199,0],[31.7831304428157,-14.3022458275829,0],[31.7832276379452,-14.3022213471374,0],[31.7833263915998,-14.3022037689887,0],[31.7834261893672,-14.3021931848675,0],[31.7835265087414,-14.3021896514312,0],[31.783626829015,-14.3021931848675,0],[31.7837266258831,-14.3022037689887,0],[31.7838253795377,-14.3022213471374,0],[31.7838649613989,-14.3022313170216,0],[31.7838933089291,-14.3022323152691,0],[31.7839931057973,-14.3022428984909,0],[31.7840918594518,-14.3022604766396,0]]]]}'),
    4,
    NULL,
    NULL,
    0,
    1569929318864
);

INSERT INTO jurisdictions
VALUES (
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    NOW(),
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    NULL,  -- no parent
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    'NYJ_24',
    'Active',
    public.ST_GeomFromGeoJSON('{"type":"MultiPolygon","coordinates":[[[[31.8002001580109,-14.3303862763055,0],[31.8002973657309,-14.330410756751,0],[31.8003925086074,-14.3304420126887,0],[31.8004850902148,-14.3304798813414,0],[31.800574627617,-14.3305241648583,0],[31.800660654066,-14.3305746312142,0],[31.8007427225986,-14.3306310196058,0],[31.8008073047134,-14.3306825768394,0],[31.8008285745791,-14.3306787915929,0],[31.8009283849371,-14.3306682083711,0],[31.8010287169018,-14.3306646740354,0],[31.8011290497659,-14.3306682083711,0],[31.8012288592245,-14.3306787915929,0],[31.8013276254696,-14.3306963697416,0],[31.8014248331896,-14.3307208510864,0],[31.8015199760661,-14.3307521070241,0],[31.8016125576734,-14.3307899756768,0],[31.801702095975,-14.3308342582943,0],[31.8017881224239,-14.3308847255496,0],[31.8018701909566,-14.3309411130419,0],[31.801947871697,-14.3310031284915,0],[31.8020207608495,-14.331070446344,0],[31.8020884780009,-14.3311427176623,0],[31.8021506697177,-14.3312195638318,0],[31.8022070122439,-14.3313005855535,0],[31.8022572124005,-14.3313853601462,0],[31.8023010066862,-14.3314734451433,0],[31.8023381684717,-14.33156438279,0],[31.8023685035037,-14.3316576964455,0],[31.8023918535013,-14.3317529022746,0],[31.8024080970561,-14.3318495020528,0],[31.8024171487325,-14.3319469930593,0],[31.8024189617657,-14.3320448662775,0],[31.8024135271626,-14.3321426117921,0],[31.8024008728021,-14.3322397205866,0],[31.8023810643347,-14.3323356863428,0],[31.8023542051825,-14.3324300081383,0],[31.8023204356397,-14.332522194044,0],[31.8022799319733,-14.3326117638218,0],[31.8022329046249,-14.3326982507236,0],[31.8021795991093,-14.3327812032899,0],[31.8021202933169,-14.3328601898459,0],[31.8020552966147,-14.3329347976028,0],[31.801984948047,-14.3330046380536,0],[31.8019096136378,-14.3330693478721,0],[31.801829686391,-14.3331285880139,0],[31.8017455835919,-14.3331820509109,0],[31.8016577432103,-14.3332294568739,0],[31.8015666239006,-14.333270560388,0],[31.8014726996054,-14.333305145616,0],[31.8013764604553,-14.3333330326932,0],[31.801278408272,-14.3333540759298,0],[31.8011817545344,-14.3333677833965,0],[31.8011833688175,-14.3333773809613,0],[31.8012088852819,-14.3334398226896,0],[31.8012131111961,-14.3334373441581,0],[31.8013026494977,-14.3333930615405,0],[31.8013952329037,-14.3333551928878,0],[31.8014903766796,-14.3333239369501,0],[31.8015875852989,-14.3332994565047,0],[31.8016863524433,-14.3332818783559,0],[31.8017861637006,-14.3332712942348,0],[31.801886497464,-14.3332677607985,0],[31.8019868312273,-14.3332712942348,0],[31.8020866415853,-14.3332818783559,0],[31.8021854087297,-14.3332994565047,0],[31.8022545647964,-14.3333168718761,0],[31.8023359930117,-14.3333140039381,0],[31.8024363267751,-14.3333175382737,0],[31.8025361380324,-14.3333281214956,0],[31.8026349051768,-14.3333456996443,0],[31.8027321137961,-14.3333701800897,0],[31.8028272575719,-14.3334014369267,0],[31.8029198400786,-14.3334393046801,0],[31.8030093792795,-14.333483588197,0],[31.8030954075271,-14.3335340554523,0],[31.8031774760597,-14.3335904429445,0],[31.8032551585987,-14.3336524574948,0],[31.8033280477513,-14.3337197762467,0],[31.803395765802,-14.3337920466656,0],[31.8034579584181,-14.3338688937344,0],[31.8035143018436,-14.3339499154562,0],[31.8035645020002,-14.3340346900488,0],[31.8036082980846,-14.334122775046,0],[31.8036454598702,-14.3342137117933,0],[31.8036757949021,-14.3343070263481,0],[31.803699145799,-14.3344022312779,0],[31.8037153893538,-14.3344988310562,0],[31.8037244410302,-14.3345963220626,0],[31.8037262540634,-14.3346941952809,0],[31.8037208194603,-14.3347919416947,0],[31.8037081642005,-14.3348890504893,0],[31.8037072585832,-14.3348934409795,0],[31.8037215191329,-14.3349110613963,0],[31.8037778625584,-14.3349920831181,0],[31.803828062715,-14.3350768577108,0],[31.8038718587993,-14.3351649427079,0],[31.8039090205849,-14.3352558794552,0],[31.8039393565161,-14.3353491940101,0],[31.8039627065137,-14.3354443989398,0],[31.8039789500685,-14.335540998718,0],[31.8039880026442,-14.3356384897245,0],[31.8039898156775,-14.3357363629427,0],[31.8039843810744,-14.3358341093566,0],[31.8039717258146,-14.3359312181511,0],[31.8039519173471,-14.3360271830081,0],[31.8039250572956,-14.3361215048035,0],[31.8038912877528,-14.3362136907092,0],[31.8038521564519,-14.3363002243758,0],[31.8038226874671,-14.3363806696321,0],[31.8037821829014,-14.3364702394099,0],[31.8037351546537,-14.3365567263118,0],[31.8036818482387,-14.336639678878,0],[31.8036501525326,-14.3366818930549,0],[31.8036181825332,-14.3367525887609,0],[31.8035711542854,-14.3368390756627,0],[31.8035178478704,-14.336922028229,0],[31.8034585411788,-14.337001014785,0],[31.8033939725539,-14.3370751288141,0],[31.8034760069123,-14.3371086825196,0],[31.8035655470125,-14.3371529651372,0],[31.8036515770587,-14.3372034323925,0],[31.8037336473899,-14.3372598198847,0],[31.803811329929,-14.337321834435,0],[31.8038263414126,-14.3373356983838,0],[31.8039148077223,-14.3373718817069,0],[31.8040043478225,-14.3374161652238,0],[31.8040903778687,-14.337466632479,0],[31.8041724481999,-14.3375230199713,0],[31.8042501316383,-14.3375850345217,0],[31.8043230225895,-14.3376523532734,0],[31.8043907415395,-14.3377246236924,0],[31.8044529350549,-14.3378014707612,0],[31.8045092793798,-14.337882492483,0],[31.8045594804357,-14.3379672670757,0],[31.80460327652,-14.3380553520728,0],[31.8046404401043,-14.3381462888201,0],[31.8046707760356,-14.338239603375,0],[31.8046941260332,-14.3383348083047,0],[31.8047103704873,-14.338431408083,0],[31.8047194221637,-14.3385288990894,0],[31.8047212351969,-14.3386267723076,0],[31.8047158005938,-14.3387245178222,0],[31.8047031453339,-14.3388216266167,0],[31.8046833359672,-14.3389175923729,0],[31.804656476815,-14.3390119141685,0],[31.8046227063729,-14.3391041000741,0],[31.8045822009079,-14.3391936698519,0],[31.8045351726602,-14.3392801567538,0],[31.8045234850708,-14.3392983446428,0],[31.8045594372683,-14.3393500421707,0],[31.8046096383242,-14.3394348167633,0],[31.8046534353078,-14.3395229017605,0],[31.8046905979928,-14.3396138385078,0],[31.804720933924,-14.3397071530626,0],[31.8047442848209,-14.3398023579924,0],[31.804760529275,-14.3398989577706,0],[31.8047695809515,-14.3399964487771,0],[31.804771394884,-14.3400943219953,0],[31.8047659593816,-14.3401920684092,0],[31.8047533041217,-14.3402891772037,0],[31.8047334947551,-14.3403851420606,0],[31.8047066356028,-14.3404794638561,0],[31.8046767682183,-14.3405609918962,0],[31.8046847892717,-14.3406086883402,0],[31.8046938409481,-14.3407061793466,0],[31.8046956539813,-14.3408040525649,0],[31.8046902193782,-14.3409017989788,0],[31.8046775641183,-14.3409989077733,0],[31.8046577547516,-14.3410948726302,0],[31.8046308947001,-14.3411891944257,0],[31.8046117220534,-14.3412415313715,0],[31.8046771324438,-14.3412091827576,0],[31.8047697185477,-14.3411713141048,0],[31.8048648650216,-14.3411400581671,0],[31.8049620781375,-14.3411155768223,0],[31.8050608488791,-14.341097999573,0],[31.8051606628344,-14.3410874154518,0],[31.8052610001951,-14.3410838811162,0],[31.8053613375557,-14.3410874154518,0],[31.805461151511,-14.341097999573,0],[31.8055599222527,-14.3411155768223,0],[31.8056571344692,-14.3411400581671,0],[31.8057522818424,-14.3411713141048,0],[31.8058448679463,-14.3412091827576,0],[31.8059344098452,-14.3412534653751,0],[31.8060204407907,-14.3413039326304,0],[31.8061025120214,-14.3413603201226,0],[31.8061801972584,-14.341422334673,0],[31.8062530891088,-14.3414896534247,0],[31.8063208089582,-14.3415619238436,0],[31.8063830042723,-14.3416387709125,0],[31.8064393494964,-14.3417197926343,0],[31.8064895514517,-14.341804567227,0],[31.8065333484353,-14.3418926522241,0],[31.8065705120196,-14.3419835889714,0],[31.8066008488502,-14.3420769035262,0],[31.8066241997471,-14.342172108456,0],[31.8066404433019,-14.3422687082343,0],[31.8066494958776,-14.3423661992406,0],[31.8066513089108,-14.3424640724589,0],[31.8066458743077,-14.3425618179735,0],[31.8066332190479,-14.342658926768,0],[31.8066134096812,-14.3427548925242,0],[31.8066104679987,-14.3427652212379,0],[31.8066078923404,-14.3427849883365,0],[31.8065880829737,-14.3428809531934,0],[31.8065612229221,-14.3429752749889,0],[31.8065274515807,-14.3430674608945,0],[31.8064869452164,-14.3431570306724,0],[31.8064399160693,-14.3432435175743,0],[31.8063866078557,-14.3433264701404,0],[31.8063273002647,-14.3434054566964,0],[31.806278998577,-14.3434608981019,0],[31.8062446660585,-14.3435066214334,0],[31.806179665759,-14.3435812291903,0],[31.8061588176753,-14.3436019261879,0],[31.8061264780546,-14.3436449947207,0],[31.8060614786544,-14.3437196024776,0],[31.8059911264893,-14.3437894438277,0],[31.8059157884829,-14.3438541527469,0],[31.8058358576388,-14.3439133928887,0],[31.8057565239445,-14.3439638214732,0],[31.8057610538296,-14.3439777546696,0],[31.8057844047265,-14.3440729595994,0],[31.8058006491806,-14.3441695593776,0],[31.8058097017564,-14.344267050384,0],[31.8058115147896,-14.3443649236023,0],[31.8058060801865,-14.3444626691169,0],[31.8057934240273,-14.3445597779114,0],[31.8057736146607,-14.3446557436676,0],[31.8057467546091,-14.3447500645638,0],[31.8057129832676,-14.3448422504694,0],[31.8056724769033,-14.3449318202473,0],[31.8056254468569,-14.3450183071491,0],[31.8055721386434,-14.3451012597153,0],[31.8055228917681,-14.3451668463728,0],[31.8055606030395,-14.3452210718949,0],[31.805610805894,-14.3453058464876,0],[31.8056546028777,-14.345393932384,0],[31.8056917673612,-14.3454848691314,0],[31.8057221041918,-14.3455781827869,0],[31.8057454559881,-14.3456733877166,0],[31.8057616995429,-14.3457699874949,0],[31.8057707521186,-14.3458674785013,0],[31.8057725660511,-14.3459653517195,0],[31.8057671305487,-14.3460630981334,0],[31.8057544752888,-14.3461602069279,0],[31.8057346650228,-14.3462561717848,0],[31.8057078049713,-14.3463504935804,0],[31.8056740327305,-14.346442679486,0],[31.8056335263662,-14.3465322492639,0],[31.8055864963198,-14.3466187352664,0],[31.8055331881062,-14.3467016887319,0],[31.8054738787166,-14.3467806743886,0],[31.8054088775177,-14.3468552821455,0],[31.8053385244534,-14.3469251225963,0],[31.8052631855476,-14.3469898324148,0],[31.8051832538042,-14.3470490725566,0],[31.8050991456091,-14.3471025354536,0],[31.8050112998317,-14.3471499414166,0],[31.8049201742267,-14.3471910449308,0],[31.8048262445356,-14.3472256301587,0],[31.8047299999895,-14.3472535163367,0],[31.8046319415109,-14.3472745604726,0],[31.8045325817133,-14.347288650151,0],[31.8044324377069,-14.3472957134264,0],[31.8043320319977,-14.3472957134264,0],[31.8042318879913,-14.347288650151,0],[31.8041325281937,-14.3472745604726,0],[31.8040344706144,-14.3472535163367,0],[31.803938225169,-14.3472256301587,0],[31.8038442954779,-14.3471910449308,0],[31.8037531698729,-14.3471499414166,0],[31.8036653240955,-14.3471025354536,0],[31.8035812159005,-14.3470490725566,0],[31.803501284157,-14.3469898324148,0],[31.8034259452512,-14.3469251225963,0],[31.8033555921869,-14.3468552821455,0],[31.8032905918873,-14.3467806743886,0],[31.8032312824977,-14.3467016887319,0],[31.8031835824564,-14.3466274631868,0],[31.8031472417518,-14.346624900119,0],[31.8030478819542,-14.3466108104405,0],[31.8029498243749,-14.346589767204,0],[31.8028535798289,-14.3465618801266,0],[31.8027596501378,-14.3465272948987,0],[31.8026685245328,-14.3464861922839,0],[31.8025806787554,-14.3464387854216,0],[31.8024965714596,-14.3463853225246,0],[31.8024166397162,-14.3463260823827,0],[31.8023413008104,-14.3462613734636,0],[31.8022785470174,-14.3461990756268,0],[31.8022759686611,-14.3461968614959,0],[31.8022056155967,-14.3461270210452,0],[31.8021406152972,-14.3460524132882,0],[31.8020915428904,-14.3459870595551,0],[31.8020745115296,-14.3459701523007,0],[31.8020095103307,-14.3458955445437,0],[31.8019502018404,-14.345816558887,0],[31.8018968936268,-14.3457336063208,0],[31.8018498635804,-14.345647119419,0],[31.8018093572161,-14.3455575496412,0],[31.8017755858746,-14.3454653637355,0],[31.8017487249238,-14.34537104194,0],[31.8017289155571,-14.3452750770831,0],[31.8017162602972,-14.3451779682886,0],[31.8017108247948,-14.3450802218747,0],[31.801712637828,-14.3449823486564,0],[31.8017136693504,-14.3449712384319,0],[31.8017105469042,-14.3449561109357,0],[31.8017030654441,-14.344939568806,0],[31.8016692941027,-14.3448473829004,0],[31.8016424331518,-14.3447530611048,0],[31.8016226237851,-14.3446570962479,0],[31.8016174679718,-14.3446175350712,0],[31.8015585902568,-14.3445499537173,0],[31.8014992808672,-14.3444709671614,0],[31.8014459726535,-14.3443880145952,0],[31.8013989435065,-14.3443015276933,0],[31.8013699619542,-14.3442374429036,0],[31.8013245785665,-14.3441770012676,0],[31.8012712703529,-14.3440940487013,0],[31.8012242403065,-14.3440075617995,0],[31.8011837348415,-14.3439179920217,0],[31.8011499635001,-14.343825806116,0],[31.8011231034485,-14.3437314852198,0],[31.8011141695833,-14.3436882080443,0],[31.8010966669776,-14.3436770825313,0],[31.8010167361335,-14.3436178423894,0],[31.8009413990264,-14.3435531334703,0],[31.8009133069036,-14.3435252454937,0],[31.8008826840887,-14.3435114328063,0],[31.8008795409581,-14.343509736685,0],[31.800840082304,-14.3435969916079,0],[31.8007930522576,-14.3436834785097,0],[31.8007397449433,-14.3437664310759,0],[31.800680436453,-14.3438454176319,0],[31.8006154361535,-14.3439200253888,0],[31.8005450839885,-14.3439898658396,0],[31.8004697459821,-14.3440545756581,0],[31.8003898151379,-14.3441138157999,0],[31.8003057087415,-14.3441672786969,0],[31.8002178638634,-14.3442146846599,0],[31.8001267391577,-14.3442557881741,0],[31.800032810366,-14.344290373402,0],[31.7999365667192,-14.3443182595799,0],[31.7998385100393,-14.3443393037159,0],[31.799739151141,-14.3443533933943,0],[31.7996390089332,-14.3443604566697,0],[31.7995386050226,-14.3443604566697,0],[31.7994384619155,-14.3443533933943,0],[31.7993391039166,-14.3443393037159,0],[31.7992410463373,-14.3443182595799,0],[31.7992275942781,-14.3443143619182,0],[31.7992185057295,-14.3443137207016,0],[31.7991191468312,-14.3442996310231,0],[31.7990210901513,-14.3442785868872,0],[31.7989248465045,-14.3442507007092,0],[31.7988309177127,-14.3442161154813,0],[31.7987397930071,-14.3441750119672,0],[31.7986519490283,-14.3441276060042,0],[31.7985678417326,-14.3440741431072,0],[31.7984879108884,-14.3440149029653,0],[31.798412572882,-14.3439501931468,0],[31.798342220717,-14.3438803526961,0],[31.7982772213168,-14.3438057449391,0],[31.7982179128265,-14.3437267583831,0],[31.7981646046129,-14.343643805817,0],[31.7981175745664,-14.3435573198144,0],[31.7981084824206,-14.3435372136714,0],[31.7981021889649,-14.3435299903168,0],[31.7980428804746,-14.3434510037608,0],[31.797989572261,-14.3433680511945,0],[31.7979425431139,-14.3432815642927,0],[31.7979020367496,-14.3431919945149,0],[31.7978682663075,-14.3430998086092,0],[31.7978414053566,-14.3430054868137,0],[31.7978215959899,-14.3429095219568,0],[31.7978089407301,-14.3428124131623,0],[31.797803506127,-14.3427146676477,0],[31.7978053191602,-14.3426167935302,0],[31.7978143717359,-14.342519303423,0],[31.7978306152907,-14.3424227036448,0],[31.7978539661876,-14.3423274978157,0],[31.7978843030182,-14.3422341841602,0],[31.7979214666025,-14.3421432474129,0],[31.7979652635861,-14.3420551615164,0],[31.7980154655414,-14.3419703869238,0],[31.7980718107655,-14.341889365202,0],[31.7981340060796,-14.3418125190325,0],[31.7982017259289,-14.3417402486135,0],[31.7982746186788,-14.3416729298618,0],[31.7983523030164,-14.3416109153114,0],[31.7984343751464,-14.3415545278191,0],[31.7985204060919,-14.3415040605639,0],[31.7986099479908,-14.341459777047,0],[31.7987025340947,-14.3414219092936,0],[31.7987976814679,-14.3413906533559,0],[31.7988948936845,-14.3413661720112,0],[31.7989936644261,-14.3413485938624,0],[31.7990934792807,-14.3413380106406,0],[31.7991938166414,-14.341334476305,0],[31.7992286527801,-14.3413357029802,0],[31.7992059493951,-14.3413096433254,0],[31.7991466418041,-14.3412306567694,0],[31.7990933344898,-14.3411477042031,0],[31.7990463053428,-14.3410612173013,0],[31.7990057998778,-14.3409716475235,0],[31.7989720294357,-14.3408794616178,0],[31.7989451693841,-14.3407851398223,0],[31.7989253600174,-14.3406891749654,0],[31.7989127047576,-14.3405920661709,0],[31.7989072692551,-14.340494319757,0],[31.7989090831877,-14.3403964465387,0],[31.7989181348641,-14.3402989555323,0],[31.7989343793182,-14.3402023557541,0],[31.7989577302151,-14.3401071508243,0],[31.7989880661464,-14.3400138362695,0],[31.7990218680648,-14.3399311256209,0],[31.7990217853272,-14.3399308360392,0],[31.7990019759605,-14.339834870283,0],[31.7989893207006,-14.3397377614884,0],[31.7989838860975,-14.3396400159739,0],[31.7989856991308,-14.3395421427556,0],[31.7989947517065,-14.3394446517493,0],[31.7990109952613,-14.339348051971,0],[31.7990343461582,-14.3392528470412,0],[31.7990646820895,-14.3391595324864,0],[31.7991018447744,-14.339068595739,0],[31.799145641758,-14.3389805107419,0],[31.799195842814,-14.3388957361493,0],[31.7992521871388,-14.3388147144275,0],[31.7992698759041,-14.3387928582038,0],[31.7992817766327,-14.3387562521992,0],[31.7993189393176,-14.3386653154519,0],[31.7993623397003,-14.3385780263548,0],[31.7993262031418,-14.3385115700528,0],[31.7992856976769,-14.3384219993757,0],[31.7992519272347,-14.3383298134701,0],[31.7992250680825,-14.3382354925739,0],[31.7992052587157,-14.3381395268177,0],[31.7992011910821,-14.3381083149467,0],[31.7991405120251,-14.3380907323014,0],[31.7990465850319,-14.3380561470735,0],[31.7989554639236,-14.3380150444587,0],[31.7988676217434,-14.3379676375964,0],[31.7987835171456,-14.3379141746993,0],[31.7987035881002,-14.3378549345575,0],[31.7986282527917,-14.337790224739,0],[31.7985579024253,-14.3377203842883,0],[31.7984929039245,-14.3376457765313,0],[31.7984335972328,-14.3375667899753,0],[31.7983802908178,-14.3374838374091,0],[31.7983332625701,-14.3373973505073,0],[31.7982927571051,-14.3373077807295,0],[31.7982589875623,-14.3372155948238,0],[31.7982321275107,-14.3371212730283,0],[31.7982123190433,-14.3370253081714,0],[31.7981996637835,-14.3369281993769,0],[31.7981991835455,-14.3369195667846,0],[31.7981571240521,-14.3368778121613,0],[31.7980921264505,-14.336803203505,0],[31.7980328197589,-14.3367242178483,0],[31.7979795133439,-14.3366412652821,0],[31.7979324850962,-14.3365547783803,0],[31.7978919805306,-14.3364652086025,0],[31.7978582100884,-14.3363730226968,0],[31.7978313509361,-14.3362787009013,0],[31.7978115424688,-14.3361827351451,0],[31.797798887209,-14.3360856263506,0],[31.7977934526058,-14.335987880836,0],[31.797795265639,-14.3358900076177,0],[31.7978011445073,-14.3358266845538,0],[31.7977982244086,-14.3358245198856,0],[31.7977228891001,-14.3357598100671,0],[31.7976525396331,-14.3356899696163,0],[31.7975911761919,-14.3356195338144,0],[31.7975767537642,-14.3356164383479,0],[31.7974805137148,-14.3355885512706,0],[31.7973865885203,-14.3355539660427,0],[31.797295467412,-14.3355128634279,0],[31.7972076261311,-14.3354654565655,0],[31.7971235224327,-14.3354119936685,0],[31.7970435942865,-14.3353527535267,0],[31.7969682598774,-14.3352880446075,0],[31.7968979104103,-14.3352182032575,0],[31.7968329128087,-14.3351435955005,0],[31.7967736070164,-14.3350646089445,0],[31.7967203006015,-14.3349816563783,0],[31.796673273253,-14.3348951694765,0],[31.7966327686874,-14.3348055996986,0],[31.7965989982452,-14.3347134137929,0],[31.796572139093,-14.3346190919975,0],[31.7965523306256,-14.3345231271406,0],[31.7965396762651,-14.3344260183461,0],[31.7965342407626,-14.3343282719322,0],[31.7965360537959,-14.3342303987139,0],[31.7965451063716,-14.3341329077075,0],[31.7965613499264,-14.3340363079292,0],[31.796584699924,-14.3339411029995,0],[31.7966150349559,-14.3338477884446,0],[31.7966521976409,-14.3337568516973,0],[31.7966959928258,-14.3336687667002,0],[31.7967461929825,-14.3335839921075,0],[31.796802536408,-14.3335029703857,0],[31.7968647290241,-14.3334261233169,0],[31.7969061751799,-14.3333818901621,0],[31.7969679792889,-14.3333055233312,0],[31.7970356973396,-14.3332332529122,0],[31.7971085864921,-14.3331659341605,0],[31.7971862681318,-14.3331039196102,0],[31.7972683375638,-14.3330475321179,0],[31.7973543649121,-14.3329970648626,0],[31.7973643177091,-14.332992142873,0],[31.7973654553516,-14.3329875032706,0],[31.7973957903835,-14.3328941887158,0],[31.7974329530684,-14.3328032519685,0],[31.7974767482534,-14.332715166072,0],[31.7974793616833,-14.3327107530988,0],[31.7974927921587,-14.332669438244,0],[31.7975299539443,-14.3325785014966,0],[31.7975737491292,-14.3324904164995,0],[31.7976239492859,-14.3324056419068,0],[31.7976802918121,-14.332324620185,0],[31.7976902059383,-14.3323123696201,0],[31.7976913831509,-14.3322488343162,0],[31.7977004348273,-14.3321513433098,0],[31.7977166783821,-14.3320547435316,0],[31.7977400283797,-14.3319595386018,0],[31.7977521368517,-14.3319222904813,0],[31.7977440303628,-14.3318600807781,0],[31.7977385948603,-14.3317623343642,0],[31.7977404078936,-14.3316644611459,0],[31.7977494604693,-14.3315669701395,0],[31.7977657031248,-14.3314703703613,0],[31.7977890531224,-14.3313751654315,0],[31.7978193881543,-14.3312818508767,0],[31.7978565499399,-14.3311909141294,0],[31.7979003451249,-14.3311028282329,0],[31.7979505443822,-14.3310180536402,0],[31.7980068869084,-14.3309370319184,0],[31.7980690795245,-14.3308601857489,0],[31.7981367957765,-14.3307879144307,0],[31.7982096849291,-14.3307205965782,0],[31.7982873656695,-14.3306585820279,0],[31.7983694342021,-14.3306021936363,0],[31.798455460651,-14.330551726381,0],[31.7985449980533,-14.3305074437635,0],[31.7986375796606,-14.3304695751108,0],[31.7987327225372,-14.330438319173,0],[31.7988299302571,-14.3304138378283,0],[31.7989286965022,-14.3303962605789,0],[31.7990285059608,-14.3303856764578,0],[31.7991288379256,-14.3303821421221,0],[31.7992291707897,-14.3303856764578,0],[31.7993289802483,-14.3303962605789,0],[31.7993518805849,-14.3304003363064,0],[31.7993842345948,-14.3303897072192,0],[31.7994814423147,-14.3303652258744,0],[31.7995802076605,-14.3303476477257,0],[31.7996800171192,-14.3303370645039,0],[31.7997803499832,-14.3303335301682,0],[31.7998806828473,-14.3303370645039,0],[31.7999804923059,-14.3303476477257,0],[31.8000792576516,-14.3303652258744,0],[31.8000869747341,-14.3303671693094,0],[31.8001013917658,-14.3303686981569,0],[31.8002001580109,-14.3303862763055,0]]]]}'),
    4,
    NULL,
    NULL,
    0,
    1569929742260
);

INSERT INTO raw_locations
VALUES
('0006b3dc-mosh-420e-970b-5b69597d80b2', 0, '{}'),
('023bd6d7-mosh-4194-907a-2f5c3bfcf4bb', 0, '{}'),
('023bd6d7-mosh-4194-133a-2f5c3bfcf4bb', 0, '{}');  -- intended to fail

INSERT INTO locations
VALUES (
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    NOW(),
    '8405b2e8-6feb-4f85-bcff-b3cb5aa57ce3',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Residential Structure',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Pending Review',
    public.ST_GeomFromGeoJSON('{"type":"Point","coordinates":[31.7841588,-14.3052436]}'),
    0,
    NULL,
    NULL,
    0,
    1572378324112
);

INSERT INTO locations
VALUES (
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    NOW(),
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '622574979',
    'Active',
    public.ST_GeomFromGeoJSON('{"type":"Polygon","coordinates":[[[31.8008263001936,-14.3355217001663,0],[31.8008654000183,-14.3355284001155,0],[31.8008567998015,-14.3355756001338,0],[31.8008176999769,-14.3355690000093,0],[31.8008263001936,-14.3355217001663,0]]]}'),
    5,
    NULL,
    NULL,
    0,
    1570473981872
);

INSERT INTO locations
VALUES (
    '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb',
    NOW(),
    '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb',
    '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb',
    '622574979',
    'Active',
    -- coordinates not within known jurisdiction
    public.ST_GeomFromGeoJSON('{"type":"Polygon","coordinates":[[[[5.1325511, 12.6921346], [5.1326329, 12.6921471], [5.1326411, 12.6920956], [5.1325593, 12.6920831], [5.1325511, 12.6921346]]]]}'),
    5,
    NULL,
    NULL,
    0,
    1570473981872
);

-- TEST process_structure_geo_hierarchy_structure_queue

-- there should be no structure_geo_hierarchy records initially
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy) AS foo
WHERE count = 0;  -- we zero records

-- lets put some stuff in the queue
INSERT INTO structure_geo_hierarchy_structure_queue
VALUES
('0006b3dc-mosh-420e-970b-5b69597d80b2', '0006b3dc-mosh-420e-970b-5b69597d80b2'),
('023bd6d7-mosh-4194-907a-2f5c3bfcf4bb', '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb'),
('023bd6d7-mosh-4194-133a-2f5c3bfcf4bb', '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb')  -- will fail
ON CONFLICT (id) DO NOTHING;

-- lets process our queue
SELECT process_structure_geo_hierarchy_structure_queue(2, FALSE, NULL);

-- should result in structure_geo_hierarchy records
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy) AS foo
WHERE count = 2;  -- we now have two records

-- and the records should match what we expect
SELECT 1/COUNT(*)
FROM structure_geo_hierarchy
WHERE
id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb'
AND jurisdiction_id = 'acdde6e5-mosh-49a9-a141-424a5862a5af'
AND jurisdiction_depth = 4
AND geo_jurisdiction_id = 'acdde6e5-mosh-49a9-a141-424a5862a5af'
AND geo_jurisdiction_depth = 4
AND geo_strict_within = 'True';

SELECT 1/COUNT(*)
FROM structure_geo_hierarchy
WHERE
id = '0006b3dc-mosh-420e-970b-5b69597d80b2'
AND jurisdiction_id = 'acdde6e5-mosh-49a9-a141-424a5862a5af'
AND jurisdiction_depth = 4
AND geo_jurisdiction_id = '6af44acb-mosh-4981-ab68-f36f175f73d7'
AND geo_jurisdiction_depth = 4
AND geo_strict_within = 'False';

-- the queue should be only have '023bd6d7-mosh-4194-133a-2f5c3bfcf4bb' afterwards
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_structure_queue) AS foo
WHERE count = 1;  -- we one records

ROLLBACK;

BEGIN;

SET search_path TO :"schema",public;

SELECT has_function_privilege(:'schema' || '.process_structure_geo_hierarchy()', 'execute');
SELECT 1/count(*) FROM pg_trigger WHERE tgname = 'process_structure_geo_hierarchy_trigger';

SELECT has_function_privilege(:'schema' || '.jurisdiction_create_structure_geo_hierarchy()', 'execute');
SELECT 1/count(*) FROM pg_trigger WHERE tgname = 'jurisdiction_create_structure_geo_hierarchy_trigger';

-- first some fixtures
INSERT INTO raw_jurisdictions
VALUES
('6af44acb-mosh-4981-ab68-f36f175f73d7', 0, '{}'),
('acdde6e5-mosh-49a9-a141-424a5862a5af', 0, '{}');

INSERT INTO jurisdictions
VALUES (
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    NOW(),
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    NULL,  -- no parent
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    '6af44acb-mosh-4981-ab68-f36f175f73d7',
    'KTM_1901',
    'Active',
    ST_GeomFromGeoJSON('{"type":"MultiPolygon","coordinates":[[[[31.7840918594518,-14.3022604766396,0],[31.7841335655117,-14.3022709816204,0],[31.7841806836917,-14.302262594543,0],[31.7842804805598,-14.3022520113212,0],[31.784380799934,-14.3022484769856,0],[31.7844811202076,-14.3022520113212,0],[31.7845809170757,-14.302262594543,0],[31.7846796716296,-14.3022801726918,0],[31.784776866759,-14.3023046540365,0],[31.7848719979444,-14.3023359099742,0],[31.7849645678606,-14.3023737786269,0],[31.7850540944709,-14.3024180621438,0],[31.7851401101281,-14.3024685284997,0],[31.7852221678688,-14.3025249168913,0],[31.785299839616,-14.3025869314417,0],[31.7853727188759,-14.3026542501934,0],[31.7854404279335,-14.3027265215117,0],[31.7855026115564,-14.3028033676812,0],[31.7855589468879,-14.3028843903023,0],[31.7856091407493,-14.302969164895,0],[31.7856529296391,-14.3030572507914,0],[31.785690086928,-14.3031481875388,0],[31.7857204183626,-14.3032415020936,0],[31.7857437656623,-14.3033367070234,0],[31.7857600065191,-14.303433307701,0],[31.7857690572962,-14.3035307987074,0],[31.7857708703294,-14.303628672825,0],[31.7857654366256,-14.3037264183395,0],[31.7857527831645,-14.3038235280333,0],[31.785732977395,-14.3039194928903,0],[31.7857061218401,-14.3040138146857,0],[31.7856723567939,-14.3041060014907,0],[31.7856318576242,-14.3041955712686,0],[31.7855848356717,-14.3042820581704,0],[31.7855315373506,-14.3043650116359,0],[31.7854722396522,-14.3044439981919,0],[31.7854072510439,-14.3045186059489,0],[31.78533691057,-14.3045884463996,0],[31.7852615860534,-14.3046531562181,0],[31.7851816686991,-14.3047123963599,0],[31.7850975766918,-14.3047658601563,0],[31.7850097471022,-14.3048132661193,0],[31.7849186394837,-14.3048543696334,0],[31.7848247268797,-14.3048889548613,0],[31.7847284994207,-14.3049168419387,0],[31.7846304598279,-14.3049378851752,0],[31.784531118916,-14.3049519757531,0],[31.7844309937954,-14.3049590390284,0],[31.784330606972,-14.3049590390284,0],[31.7842304818513,-14.3049519757531,0],[31.7841311409395,-14.3049378851752,0],[31.7840406790341,-14.3049184688122,0],[31.7839433067383,-14.3049322797009,0],[31.7838431816176,-14.3049393429762,0],[31.7837427956935,-14.3049393429762,0],[31.7836426705728,-14.3049322797009,0],[31.7835433287617,-14.3049181891231,0],[31.7834513820757,-14.3048984535008,0],[31.7833761906587,-14.3048931492993,0],[31.7832768497469,-14.3048790587216,0],[31.783178810154,-14.304858015485,0],[31.7830825826951,-14.3048301284077,0],[31.7829886700911,-14.3047955431798,0],[31.7828975624726,-14.3047544405649,0],[31.7828097328829,-14.3047070337026,0],[31.7827256408757,-14.3046535708056,0],[31.7826457235214,-14.3045943297645,0],[31.7825703990048,-14.3045296208453,0],[31.7825000594303,-14.3044597794952,0],[31.7824350708219,-14.3043851717383,0],[31.7823757722242,-14.3043061851823,0],[31.7823224739031,-14.304223232616,0],[31.7822754519506,-14.3041367457142,0],[31.7822349536802,-14.3040471750371,0],[31.7822011877347,-14.3039549891314,0],[31.7821743321797,-14.3038606673359,0],[31.7821545264103,-14.3037647015797,0],[31.7821418738484,-14.3036675927851,0],[31.7821364392453,-14.3035698463713,0],[31.7821382522786,-14.3034719722536,0],[31.7821473030556,-14.3033744812473,0],[31.7821635439125,-14.303277881469,0],[31.7821868912121,-14.3031826756399,0],[31.7822172226468,-14.3030893610851,0],[31.7822543799358,-14.3029984243378,0],[31.7822981688255,-14.3029103384413,0],[31.7823483626868,-14.3028255638487,0],[31.7824046980185,-14.3027445421268,0],[31.7824668825406,-14.3026676950581,0],[31.7825345906988,-14.3025954246391,0],[31.7826074708581,-14.3025281058873,0],[31.782685141706,-14.302466091337,0],[31.7827671994468,-14.3024097029454,0],[31.7828532160032,-14.3023592356901,0],[31.7829427417142,-14.3023149521733,0],[31.7830353116304,-14.3022770844199,0],[31.7831304428157,-14.3022458275829,0],[31.7832276379452,-14.3022213471374,0],[31.7833263915998,-14.3022037689887,0],[31.7834261893672,-14.3021931848675,0],[31.7835265087414,-14.3021896514312,0],[31.783626829015,-14.3021931848675,0],[31.7837266258831,-14.3022037689887,0],[31.7838253795377,-14.3022213471374,0],[31.7838649613989,-14.3022313170216,0],[31.7838933089291,-14.3022323152691,0],[31.7839931057973,-14.3022428984909,0],[31.7840918594518,-14.3022604766396,0]]]]}'),
    4,
    NULL,
    NULL,
    0,
    1569929318864
);

INSERT INTO jurisdictions
VALUES (
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    NOW(),
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    NULL,  -- no parent
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    'NYJ_24',
    'Active',
    ST_GeomFromGeoJSON('{"type":"MultiPolygon","coordinates":[[[[31.8002001580109,-14.3303862763055,0],[31.8002973657309,-14.330410756751,0],[31.8003925086074,-14.3304420126887,0],[31.8004850902148,-14.3304798813414,0],[31.800574627617,-14.3305241648583,0],[31.800660654066,-14.3305746312142,0],[31.8007427225986,-14.3306310196058,0],[31.8008073047134,-14.3306825768394,0],[31.8008285745791,-14.3306787915929,0],[31.8009283849371,-14.3306682083711,0],[31.8010287169018,-14.3306646740354,0],[31.8011290497659,-14.3306682083711,0],[31.8012288592245,-14.3306787915929,0],[31.8013276254696,-14.3306963697416,0],[31.8014248331896,-14.3307208510864,0],[31.8015199760661,-14.3307521070241,0],[31.8016125576734,-14.3307899756768,0],[31.801702095975,-14.3308342582943,0],[31.8017881224239,-14.3308847255496,0],[31.8018701909566,-14.3309411130419,0],[31.801947871697,-14.3310031284915,0],[31.8020207608495,-14.331070446344,0],[31.8020884780009,-14.3311427176623,0],[31.8021506697177,-14.3312195638318,0],[31.8022070122439,-14.3313005855535,0],[31.8022572124005,-14.3313853601462,0],[31.8023010066862,-14.3314734451433,0],[31.8023381684717,-14.33156438279,0],[31.8023685035037,-14.3316576964455,0],[31.8023918535013,-14.3317529022746,0],[31.8024080970561,-14.3318495020528,0],[31.8024171487325,-14.3319469930593,0],[31.8024189617657,-14.3320448662775,0],[31.8024135271626,-14.3321426117921,0],[31.8024008728021,-14.3322397205866,0],[31.8023810643347,-14.3323356863428,0],[31.8023542051825,-14.3324300081383,0],[31.8023204356397,-14.332522194044,0],[31.8022799319733,-14.3326117638218,0],[31.8022329046249,-14.3326982507236,0],[31.8021795991093,-14.3327812032899,0],[31.8021202933169,-14.3328601898459,0],[31.8020552966147,-14.3329347976028,0],[31.801984948047,-14.3330046380536,0],[31.8019096136378,-14.3330693478721,0],[31.801829686391,-14.3331285880139,0],[31.8017455835919,-14.3331820509109,0],[31.8016577432103,-14.3332294568739,0],[31.8015666239006,-14.333270560388,0],[31.8014726996054,-14.333305145616,0],[31.8013764604553,-14.3333330326932,0],[31.801278408272,-14.3333540759298,0],[31.8011817545344,-14.3333677833965,0],[31.8011833688175,-14.3333773809613,0],[31.8012088852819,-14.3334398226896,0],[31.8012131111961,-14.3334373441581,0],[31.8013026494977,-14.3333930615405,0],[31.8013952329037,-14.3333551928878,0],[31.8014903766796,-14.3333239369501,0],[31.8015875852989,-14.3332994565047,0],[31.8016863524433,-14.3332818783559,0],[31.8017861637006,-14.3332712942348,0],[31.801886497464,-14.3332677607985,0],[31.8019868312273,-14.3332712942348,0],[31.8020866415853,-14.3332818783559,0],[31.8021854087297,-14.3332994565047,0],[31.8022545647964,-14.3333168718761,0],[31.8023359930117,-14.3333140039381,0],[31.8024363267751,-14.3333175382737,0],[31.8025361380324,-14.3333281214956,0],[31.8026349051768,-14.3333456996443,0],[31.8027321137961,-14.3333701800897,0],[31.8028272575719,-14.3334014369267,0],[31.8029198400786,-14.3334393046801,0],[31.8030093792795,-14.333483588197,0],[31.8030954075271,-14.3335340554523,0],[31.8031774760597,-14.3335904429445,0],[31.8032551585987,-14.3336524574948,0],[31.8033280477513,-14.3337197762467,0],[31.803395765802,-14.3337920466656,0],[31.8034579584181,-14.3338688937344,0],[31.8035143018436,-14.3339499154562,0],[31.8035645020002,-14.3340346900488,0],[31.8036082980846,-14.334122775046,0],[31.8036454598702,-14.3342137117933,0],[31.8036757949021,-14.3343070263481,0],[31.803699145799,-14.3344022312779,0],[31.8037153893538,-14.3344988310562,0],[31.8037244410302,-14.3345963220626,0],[31.8037262540634,-14.3346941952809,0],[31.8037208194603,-14.3347919416947,0],[31.8037081642005,-14.3348890504893,0],[31.8037072585832,-14.3348934409795,0],[31.8037215191329,-14.3349110613963,0],[31.8037778625584,-14.3349920831181,0],[31.803828062715,-14.3350768577108,0],[31.8038718587993,-14.3351649427079,0],[31.8039090205849,-14.3352558794552,0],[31.8039393565161,-14.3353491940101,0],[31.8039627065137,-14.3354443989398,0],[31.8039789500685,-14.335540998718,0],[31.8039880026442,-14.3356384897245,0],[31.8039898156775,-14.3357363629427,0],[31.8039843810744,-14.3358341093566,0],[31.8039717258146,-14.3359312181511,0],[31.8039519173471,-14.3360271830081,0],[31.8039250572956,-14.3361215048035,0],[31.8038912877528,-14.3362136907092,0],[31.8038521564519,-14.3363002243758,0],[31.8038226874671,-14.3363806696321,0],[31.8037821829014,-14.3364702394099,0],[31.8037351546537,-14.3365567263118,0],[31.8036818482387,-14.336639678878,0],[31.8036501525326,-14.3366818930549,0],[31.8036181825332,-14.3367525887609,0],[31.8035711542854,-14.3368390756627,0],[31.8035178478704,-14.336922028229,0],[31.8034585411788,-14.337001014785,0],[31.8033939725539,-14.3370751288141,0],[31.8034760069123,-14.3371086825196,0],[31.8035655470125,-14.3371529651372,0],[31.8036515770587,-14.3372034323925,0],[31.8037336473899,-14.3372598198847,0],[31.803811329929,-14.337321834435,0],[31.8038263414126,-14.3373356983838,0],[31.8039148077223,-14.3373718817069,0],[31.8040043478225,-14.3374161652238,0],[31.8040903778687,-14.337466632479,0],[31.8041724481999,-14.3375230199713,0],[31.8042501316383,-14.3375850345217,0],[31.8043230225895,-14.3376523532734,0],[31.8043907415395,-14.3377246236924,0],[31.8044529350549,-14.3378014707612,0],[31.8045092793798,-14.337882492483,0],[31.8045594804357,-14.3379672670757,0],[31.80460327652,-14.3380553520728,0],[31.8046404401043,-14.3381462888201,0],[31.8046707760356,-14.338239603375,0],[31.8046941260332,-14.3383348083047,0],[31.8047103704873,-14.338431408083,0],[31.8047194221637,-14.3385288990894,0],[31.8047212351969,-14.3386267723076,0],[31.8047158005938,-14.3387245178222,0],[31.8047031453339,-14.3388216266167,0],[31.8046833359672,-14.3389175923729,0],[31.804656476815,-14.3390119141685,0],[31.8046227063729,-14.3391041000741,0],[31.8045822009079,-14.3391936698519,0],[31.8045351726602,-14.3392801567538,0],[31.8045234850708,-14.3392983446428,0],[31.8045594372683,-14.3393500421707,0],[31.8046096383242,-14.3394348167633,0],[31.8046534353078,-14.3395229017605,0],[31.8046905979928,-14.3396138385078,0],[31.804720933924,-14.3397071530626,0],[31.8047442848209,-14.3398023579924,0],[31.804760529275,-14.3398989577706,0],[31.8047695809515,-14.3399964487771,0],[31.804771394884,-14.3400943219953,0],[31.8047659593816,-14.3401920684092,0],[31.8047533041217,-14.3402891772037,0],[31.8047334947551,-14.3403851420606,0],[31.8047066356028,-14.3404794638561,0],[31.8046767682183,-14.3405609918962,0],[31.8046847892717,-14.3406086883402,0],[31.8046938409481,-14.3407061793466,0],[31.8046956539813,-14.3408040525649,0],[31.8046902193782,-14.3409017989788,0],[31.8046775641183,-14.3409989077733,0],[31.8046577547516,-14.3410948726302,0],[31.8046308947001,-14.3411891944257,0],[31.8046117220534,-14.3412415313715,0],[31.8046771324438,-14.3412091827576,0],[31.8047697185477,-14.3411713141048,0],[31.8048648650216,-14.3411400581671,0],[31.8049620781375,-14.3411155768223,0],[31.8050608488791,-14.341097999573,0],[31.8051606628344,-14.3410874154518,0],[31.8052610001951,-14.3410838811162,0],[31.8053613375557,-14.3410874154518,0],[31.805461151511,-14.341097999573,0],[31.8055599222527,-14.3411155768223,0],[31.8056571344692,-14.3411400581671,0],[31.8057522818424,-14.3411713141048,0],[31.8058448679463,-14.3412091827576,0],[31.8059344098452,-14.3412534653751,0],[31.8060204407907,-14.3413039326304,0],[31.8061025120214,-14.3413603201226,0],[31.8061801972584,-14.341422334673,0],[31.8062530891088,-14.3414896534247,0],[31.8063208089582,-14.3415619238436,0],[31.8063830042723,-14.3416387709125,0],[31.8064393494964,-14.3417197926343,0],[31.8064895514517,-14.341804567227,0],[31.8065333484353,-14.3418926522241,0],[31.8065705120196,-14.3419835889714,0],[31.8066008488502,-14.3420769035262,0],[31.8066241997471,-14.342172108456,0],[31.8066404433019,-14.3422687082343,0],[31.8066494958776,-14.3423661992406,0],[31.8066513089108,-14.3424640724589,0],[31.8066458743077,-14.3425618179735,0],[31.8066332190479,-14.342658926768,0],[31.8066134096812,-14.3427548925242,0],[31.8066104679987,-14.3427652212379,0],[31.8066078923404,-14.3427849883365,0],[31.8065880829737,-14.3428809531934,0],[31.8065612229221,-14.3429752749889,0],[31.8065274515807,-14.3430674608945,0],[31.8064869452164,-14.3431570306724,0],[31.8064399160693,-14.3432435175743,0],[31.8063866078557,-14.3433264701404,0],[31.8063273002647,-14.3434054566964,0],[31.806278998577,-14.3434608981019,0],[31.8062446660585,-14.3435066214334,0],[31.806179665759,-14.3435812291903,0],[31.8061588176753,-14.3436019261879,0],[31.8061264780546,-14.3436449947207,0],[31.8060614786544,-14.3437196024776,0],[31.8059911264893,-14.3437894438277,0],[31.8059157884829,-14.3438541527469,0],[31.8058358576388,-14.3439133928887,0],[31.8057565239445,-14.3439638214732,0],[31.8057610538296,-14.3439777546696,0],[31.8057844047265,-14.3440729595994,0],[31.8058006491806,-14.3441695593776,0],[31.8058097017564,-14.344267050384,0],[31.8058115147896,-14.3443649236023,0],[31.8058060801865,-14.3444626691169,0],[31.8057934240273,-14.3445597779114,0],[31.8057736146607,-14.3446557436676,0],[31.8057467546091,-14.3447500645638,0],[31.8057129832676,-14.3448422504694,0],[31.8056724769033,-14.3449318202473,0],[31.8056254468569,-14.3450183071491,0],[31.8055721386434,-14.3451012597153,0],[31.8055228917681,-14.3451668463728,0],[31.8055606030395,-14.3452210718949,0],[31.805610805894,-14.3453058464876,0],[31.8056546028777,-14.345393932384,0],[31.8056917673612,-14.3454848691314,0],[31.8057221041918,-14.3455781827869,0],[31.8057454559881,-14.3456733877166,0],[31.8057616995429,-14.3457699874949,0],[31.8057707521186,-14.3458674785013,0],[31.8057725660511,-14.3459653517195,0],[31.8057671305487,-14.3460630981334,0],[31.8057544752888,-14.3461602069279,0],[31.8057346650228,-14.3462561717848,0],[31.8057078049713,-14.3463504935804,0],[31.8056740327305,-14.346442679486,0],[31.8056335263662,-14.3465322492639,0],[31.8055864963198,-14.3466187352664,0],[31.8055331881062,-14.3467016887319,0],[31.8054738787166,-14.3467806743886,0],[31.8054088775177,-14.3468552821455,0],[31.8053385244534,-14.3469251225963,0],[31.8052631855476,-14.3469898324148,0],[31.8051832538042,-14.3470490725566,0],[31.8050991456091,-14.3471025354536,0],[31.8050112998317,-14.3471499414166,0],[31.8049201742267,-14.3471910449308,0],[31.8048262445356,-14.3472256301587,0],[31.8047299999895,-14.3472535163367,0],[31.8046319415109,-14.3472745604726,0],[31.8045325817133,-14.347288650151,0],[31.8044324377069,-14.3472957134264,0],[31.8043320319977,-14.3472957134264,0],[31.8042318879913,-14.347288650151,0],[31.8041325281937,-14.3472745604726,0],[31.8040344706144,-14.3472535163367,0],[31.803938225169,-14.3472256301587,0],[31.8038442954779,-14.3471910449308,0],[31.8037531698729,-14.3471499414166,0],[31.8036653240955,-14.3471025354536,0],[31.8035812159005,-14.3470490725566,0],[31.803501284157,-14.3469898324148,0],[31.8034259452512,-14.3469251225963,0],[31.8033555921869,-14.3468552821455,0],[31.8032905918873,-14.3467806743886,0],[31.8032312824977,-14.3467016887319,0],[31.8031835824564,-14.3466274631868,0],[31.8031472417518,-14.346624900119,0],[31.8030478819542,-14.3466108104405,0],[31.8029498243749,-14.346589767204,0],[31.8028535798289,-14.3465618801266,0],[31.8027596501378,-14.3465272948987,0],[31.8026685245328,-14.3464861922839,0],[31.8025806787554,-14.3464387854216,0],[31.8024965714596,-14.3463853225246,0],[31.8024166397162,-14.3463260823827,0],[31.8023413008104,-14.3462613734636,0],[31.8022785470174,-14.3461990756268,0],[31.8022759686611,-14.3461968614959,0],[31.8022056155967,-14.3461270210452,0],[31.8021406152972,-14.3460524132882,0],[31.8020915428904,-14.3459870595551,0],[31.8020745115296,-14.3459701523007,0],[31.8020095103307,-14.3458955445437,0],[31.8019502018404,-14.345816558887,0],[31.8018968936268,-14.3457336063208,0],[31.8018498635804,-14.345647119419,0],[31.8018093572161,-14.3455575496412,0],[31.8017755858746,-14.3454653637355,0],[31.8017487249238,-14.34537104194,0],[31.8017289155571,-14.3452750770831,0],[31.8017162602972,-14.3451779682886,0],[31.8017108247948,-14.3450802218747,0],[31.801712637828,-14.3449823486564,0],[31.8017136693504,-14.3449712384319,0],[31.8017105469042,-14.3449561109357,0],[31.8017030654441,-14.344939568806,0],[31.8016692941027,-14.3448473829004,0],[31.8016424331518,-14.3447530611048,0],[31.8016226237851,-14.3446570962479,0],[31.8016174679718,-14.3446175350712,0],[31.8015585902568,-14.3445499537173,0],[31.8014992808672,-14.3444709671614,0],[31.8014459726535,-14.3443880145952,0],[31.8013989435065,-14.3443015276933,0],[31.8013699619542,-14.3442374429036,0],[31.8013245785665,-14.3441770012676,0],[31.8012712703529,-14.3440940487013,0],[31.8012242403065,-14.3440075617995,0],[31.8011837348415,-14.3439179920217,0],[31.8011499635001,-14.343825806116,0],[31.8011231034485,-14.3437314852198,0],[31.8011141695833,-14.3436882080443,0],[31.8010966669776,-14.3436770825313,0],[31.8010167361335,-14.3436178423894,0],[31.8009413990264,-14.3435531334703,0],[31.8009133069036,-14.3435252454937,0],[31.8008826840887,-14.3435114328063,0],[31.8008795409581,-14.343509736685,0],[31.800840082304,-14.3435969916079,0],[31.8007930522576,-14.3436834785097,0],[31.8007397449433,-14.3437664310759,0],[31.800680436453,-14.3438454176319,0],[31.8006154361535,-14.3439200253888,0],[31.8005450839885,-14.3439898658396,0],[31.8004697459821,-14.3440545756581,0],[31.8003898151379,-14.3441138157999,0],[31.8003057087415,-14.3441672786969,0],[31.8002178638634,-14.3442146846599,0],[31.8001267391577,-14.3442557881741,0],[31.800032810366,-14.344290373402,0],[31.7999365667192,-14.3443182595799,0],[31.7998385100393,-14.3443393037159,0],[31.799739151141,-14.3443533933943,0],[31.7996390089332,-14.3443604566697,0],[31.7995386050226,-14.3443604566697,0],[31.7994384619155,-14.3443533933943,0],[31.7993391039166,-14.3443393037159,0],[31.7992410463373,-14.3443182595799,0],[31.7992275942781,-14.3443143619182,0],[31.7992185057295,-14.3443137207016,0],[31.7991191468312,-14.3442996310231,0],[31.7990210901513,-14.3442785868872,0],[31.7989248465045,-14.3442507007092,0],[31.7988309177127,-14.3442161154813,0],[31.7987397930071,-14.3441750119672,0],[31.7986519490283,-14.3441276060042,0],[31.7985678417326,-14.3440741431072,0],[31.7984879108884,-14.3440149029653,0],[31.798412572882,-14.3439501931468,0],[31.798342220717,-14.3438803526961,0],[31.7982772213168,-14.3438057449391,0],[31.7982179128265,-14.3437267583831,0],[31.7981646046129,-14.343643805817,0],[31.7981175745664,-14.3435573198144,0],[31.7981084824206,-14.3435372136714,0],[31.7981021889649,-14.3435299903168,0],[31.7980428804746,-14.3434510037608,0],[31.797989572261,-14.3433680511945,0],[31.7979425431139,-14.3432815642927,0],[31.7979020367496,-14.3431919945149,0],[31.7978682663075,-14.3430998086092,0],[31.7978414053566,-14.3430054868137,0],[31.7978215959899,-14.3429095219568,0],[31.7978089407301,-14.3428124131623,0],[31.797803506127,-14.3427146676477,0],[31.7978053191602,-14.3426167935302,0],[31.7978143717359,-14.342519303423,0],[31.7978306152907,-14.3424227036448,0],[31.7978539661876,-14.3423274978157,0],[31.7978843030182,-14.3422341841602,0],[31.7979214666025,-14.3421432474129,0],[31.7979652635861,-14.3420551615164,0],[31.7980154655414,-14.3419703869238,0],[31.7980718107655,-14.341889365202,0],[31.7981340060796,-14.3418125190325,0],[31.7982017259289,-14.3417402486135,0],[31.7982746186788,-14.3416729298618,0],[31.7983523030164,-14.3416109153114,0],[31.7984343751464,-14.3415545278191,0],[31.7985204060919,-14.3415040605639,0],[31.7986099479908,-14.341459777047,0],[31.7987025340947,-14.3414219092936,0],[31.7987976814679,-14.3413906533559,0],[31.7988948936845,-14.3413661720112,0],[31.7989936644261,-14.3413485938624,0],[31.7990934792807,-14.3413380106406,0],[31.7991938166414,-14.341334476305,0],[31.7992286527801,-14.3413357029802,0],[31.7992059493951,-14.3413096433254,0],[31.7991466418041,-14.3412306567694,0],[31.7990933344898,-14.3411477042031,0],[31.7990463053428,-14.3410612173013,0],[31.7990057998778,-14.3409716475235,0],[31.7989720294357,-14.3408794616178,0],[31.7989451693841,-14.3407851398223,0],[31.7989253600174,-14.3406891749654,0],[31.7989127047576,-14.3405920661709,0],[31.7989072692551,-14.340494319757,0],[31.7989090831877,-14.3403964465387,0],[31.7989181348641,-14.3402989555323,0],[31.7989343793182,-14.3402023557541,0],[31.7989577302151,-14.3401071508243,0],[31.7989880661464,-14.3400138362695,0],[31.7990218680648,-14.3399311256209,0],[31.7990217853272,-14.3399308360392,0],[31.7990019759605,-14.339834870283,0],[31.7989893207006,-14.3397377614884,0],[31.7989838860975,-14.3396400159739,0],[31.7989856991308,-14.3395421427556,0],[31.7989947517065,-14.3394446517493,0],[31.7990109952613,-14.339348051971,0],[31.7990343461582,-14.3392528470412,0],[31.7990646820895,-14.3391595324864,0],[31.7991018447744,-14.339068595739,0],[31.799145641758,-14.3389805107419,0],[31.799195842814,-14.3388957361493,0],[31.7992521871388,-14.3388147144275,0],[31.7992698759041,-14.3387928582038,0],[31.7992817766327,-14.3387562521992,0],[31.7993189393176,-14.3386653154519,0],[31.7993623397003,-14.3385780263548,0],[31.7993262031418,-14.3385115700528,0],[31.7992856976769,-14.3384219993757,0],[31.7992519272347,-14.3383298134701,0],[31.7992250680825,-14.3382354925739,0],[31.7992052587157,-14.3381395268177,0],[31.7992011910821,-14.3381083149467,0],[31.7991405120251,-14.3380907323014,0],[31.7990465850319,-14.3380561470735,0],[31.7989554639236,-14.3380150444587,0],[31.7988676217434,-14.3379676375964,0],[31.7987835171456,-14.3379141746993,0],[31.7987035881002,-14.3378549345575,0],[31.7986282527917,-14.337790224739,0],[31.7985579024253,-14.3377203842883,0],[31.7984929039245,-14.3376457765313,0],[31.7984335972328,-14.3375667899753,0],[31.7983802908178,-14.3374838374091,0],[31.7983332625701,-14.3373973505073,0],[31.7982927571051,-14.3373077807295,0],[31.7982589875623,-14.3372155948238,0],[31.7982321275107,-14.3371212730283,0],[31.7982123190433,-14.3370253081714,0],[31.7981996637835,-14.3369281993769,0],[31.7981991835455,-14.3369195667846,0],[31.7981571240521,-14.3368778121613,0],[31.7980921264505,-14.336803203505,0],[31.7980328197589,-14.3367242178483,0],[31.7979795133439,-14.3366412652821,0],[31.7979324850962,-14.3365547783803,0],[31.7978919805306,-14.3364652086025,0],[31.7978582100884,-14.3363730226968,0],[31.7978313509361,-14.3362787009013,0],[31.7978115424688,-14.3361827351451,0],[31.797798887209,-14.3360856263506,0],[31.7977934526058,-14.335987880836,0],[31.797795265639,-14.3358900076177,0],[31.7978011445073,-14.3358266845538,0],[31.7977982244086,-14.3358245198856,0],[31.7977228891001,-14.3357598100671,0],[31.7976525396331,-14.3356899696163,0],[31.7975911761919,-14.3356195338144,0],[31.7975767537642,-14.3356164383479,0],[31.7974805137148,-14.3355885512706,0],[31.7973865885203,-14.3355539660427,0],[31.797295467412,-14.3355128634279,0],[31.7972076261311,-14.3354654565655,0],[31.7971235224327,-14.3354119936685,0],[31.7970435942865,-14.3353527535267,0],[31.7969682598774,-14.3352880446075,0],[31.7968979104103,-14.3352182032575,0],[31.7968329128087,-14.3351435955005,0],[31.7967736070164,-14.3350646089445,0],[31.7967203006015,-14.3349816563783,0],[31.796673273253,-14.3348951694765,0],[31.7966327686874,-14.3348055996986,0],[31.7965989982452,-14.3347134137929,0],[31.796572139093,-14.3346190919975,0],[31.7965523306256,-14.3345231271406,0],[31.7965396762651,-14.3344260183461,0],[31.7965342407626,-14.3343282719322,0],[31.7965360537959,-14.3342303987139,0],[31.7965451063716,-14.3341329077075,0],[31.7965613499264,-14.3340363079292,0],[31.796584699924,-14.3339411029995,0],[31.7966150349559,-14.3338477884446,0],[31.7966521976409,-14.3337568516973,0],[31.7966959928258,-14.3336687667002,0],[31.7967461929825,-14.3335839921075,0],[31.796802536408,-14.3335029703857,0],[31.7968647290241,-14.3334261233169,0],[31.7969061751799,-14.3333818901621,0],[31.7969679792889,-14.3333055233312,0],[31.7970356973396,-14.3332332529122,0],[31.7971085864921,-14.3331659341605,0],[31.7971862681318,-14.3331039196102,0],[31.7972683375638,-14.3330475321179,0],[31.7973543649121,-14.3329970648626,0],[31.7973643177091,-14.332992142873,0],[31.7973654553516,-14.3329875032706,0],[31.7973957903835,-14.3328941887158,0],[31.7974329530684,-14.3328032519685,0],[31.7974767482534,-14.332715166072,0],[31.7974793616833,-14.3327107530988,0],[31.7974927921587,-14.332669438244,0],[31.7975299539443,-14.3325785014966,0],[31.7975737491292,-14.3324904164995,0],[31.7976239492859,-14.3324056419068,0],[31.7976802918121,-14.332324620185,0],[31.7976902059383,-14.3323123696201,0],[31.7976913831509,-14.3322488343162,0],[31.7977004348273,-14.3321513433098,0],[31.7977166783821,-14.3320547435316,0],[31.7977400283797,-14.3319595386018,0],[31.7977521368517,-14.3319222904813,0],[31.7977440303628,-14.3318600807781,0],[31.7977385948603,-14.3317623343642,0],[31.7977404078936,-14.3316644611459,0],[31.7977494604693,-14.3315669701395,0],[31.7977657031248,-14.3314703703613,0],[31.7977890531224,-14.3313751654315,0],[31.7978193881543,-14.3312818508767,0],[31.7978565499399,-14.3311909141294,0],[31.7979003451249,-14.3311028282329,0],[31.7979505443822,-14.3310180536402,0],[31.7980068869084,-14.3309370319184,0],[31.7980690795245,-14.3308601857489,0],[31.7981367957765,-14.3307879144307,0],[31.7982096849291,-14.3307205965782,0],[31.7982873656695,-14.3306585820279,0],[31.7983694342021,-14.3306021936363,0],[31.798455460651,-14.330551726381,0],[31.7985449980533,-14.3305074437635,0],[31.7986375796606,-14.3304695751108,0],[31.7987327225372,-14.330438319173,0],[31.7988299302571,-14.3304138378283,0],[31.7989286965022,-14.3303962605789,0],[31.7990285059608,-14.3303856764578,0],[31.7991288379256,-14.3303821421221,0],[31.7992291707897,-14.3303856764578,0],[31.7993289802483,-14.3303962605789,0],[31.7993518805849,-14.3304003363064,0],[31.7993842345948,-14.3303897072192,0],[31.7994814423147,-14.3303652258744,0],[31.7995802076605,-14.3303476477257,0],[31.7996800171192,-14.3303370645039,0],[31.7997803499832,-14.3303335301682,0],[31.7998806828473,-14.3303370645039,0],[31.7999804923059,-14.3303476477257,0],[31.8000792576516,-14.3303652258744,0],[31.8000869747341,-14.3303671693094,0],[31.8001013917658,-14.3303686981569,0],[31.8002001580109,-14.3303862763055,0]]]]}'),
    4,
    NULL,
    NULL,
    0,
    1569929742260
);

INSERT INTO raw_locations
VALUES
('0006b3dc-mosh-420e-970b-5b69597d80b2', 0, '{}'),
('023bd6d7-mosh-4194-907a-2f5c3bfcf4bb', 0, '{}');


INSERT INTO locations
VALUES (
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    NOW(),
    '8405b2e8-6feb-4f85-bcff-b3cb5aa57ce3',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Residential Structure',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Pending Review',
    ST_GeomFromGeoJSON('{"type":"Point","coordinates":[31.7841588,-14.3052436]}'),
    0,
    NULL,
    NULL,
    0,
    1572378324112
);

INSERT INTO locations
VALUES (
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    NOW(),
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '622574979',
    'Active',
    ST_GeomFromGeoJSON('{"type":"Polygon","coordinates":[[[31.8008263001936,-14.3355217001663,0],[31.8008654000183,-14.3355284001155,0],[31.8008567998015,-14.3355756001338,0],[31.8008176999769,-14.3355690000093,0],[31.8008263001936,-14.3355217001663,0]]]}'),
    5,
    NULL,
    NULL,
    0,
    1570473981872
);

-- we should have corresponding records in the structure_geo_hierarchy_jurisdiction_queue table
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_jurisdiction_queue) AS foo WHERE count = 2;

SELECT 1/COUNT(*)
FROM structure_geo_hierarchy_jurisdiction_queue
WHERE
id = '6af44acb-mosh-4981-ab68-f36f175f73d7'
AND jurisdiction_id = '6af44acb-mosh-4981-ab68-f36f175f73d7';

SELECT 1/COUNT(*)
FROM structure_geo_hierarchy_jurisdiction_queue
WHERE
id = 'acdde6e5-mosh-49a9-a141-424a5862a5af'
AND jurisdiction_id = 'acdde6e5-mosh-49a9-a141-424a5862a5af';

-- we should have corresponding records in the structure_geo_hierarchy_structure_queue table
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_structure_queue) AS foo WHERE count = 2;

SELECT 1/COUNT(*)
FROM structure_geo_hierarchy_structure_queue
WHERE
id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb'
AND structure_id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb';

SELECT 1/COUNT(*)
FROM structure_geo_hierarchy_structure_queue
WHERE
id = '0006b3dc-mosh-420e-970b-5b69597d80b2'
AND structure_id = '0006b3dc-mosh-420e-970b-5b69597d80b2';

-- lets delete from structure_geo_hierarchy_structure_queue and then update locations
-- to ensure that triggers work on update
TRUNCATE structure_geo_hierarchy_structure_queue;

UPDATE locations
SET name = 'Structure 1'
WHERE id = '0006b3dc-mosh-420e-970b-5b69597d80b2';

-- should result in a structure_geo_hierarchy_structure_queue record
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_structure_queue) AS foo
WHERE count = 1;  -- we have just 1 record

SELECT 1/COUNT(*)
FROM structure_geo_hierarchy_structure_queue
WHERE
id = '0006b3dc-mosh-420e-970b-5b69597d80b2'
AND structure_id = '0006b3dc-mosh-420e-970b-5b69597d80b2';

UPDATE locations
SET name = 'Structure 2'
WHERE id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb';

-- should result in a structure_geo_hierarchy_structure_queue record
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_structure_queue) AS foo
WHERE count = 2;  -- we now have two records

SELECT 1/COUNT(*)
FROM structure_geo_hierarchy_structure_queue
WHERE
id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb'
AND structure_id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb';

-- -- lets delete from structure_geo_hierarchy_structure_queue and then bulk update locations
-- -- to ensure that triggers work on bulk update
DELETE FROM structure_geo_hierarchy_structure_queue;

UPDATE locations SET name = 'Shared Name (bad)';

-- should result in structure_geo_hierarchy records
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_structure_queue) AS foo
WHERE count = 2;  -- we now have two records

-- lets confirm that when a jurisdiction is UPDATED then structure_geo_hierarchy_jurisdiction_queue
-- records for locations in the jurisdiction are updated

-- first lets delete all structure_geo_hierarchy_jurisdiction_queue records
DELETE FROM structure_geo_hierarchy_jurisdiction_queue;

-- lets update the jurisdiction where our locations are in
UPDATE jurisdictions
SET name = 'Jurisdiction 1'
WHERE id = 'acdde6e5-mosh-49a9-a141-424a5862a5af';

-- should result in structure_geo_hierarchy_jurisdiction_queue records
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_jurisdiction_queue) AS foo
WHERE count = 1;  -- we one record

-- and the records should match what we expect
SELECT 1/COUNT(*)
FROM structure_geo_hierarchy_jurisdiction_queue
WHERE
id = 'acdde6e5-mosh-49a9-a141-424a5862a5af'
AND jurisdiction_id = 'acdde6e5-mosh-49a9-a141-424a5862a5af';

-- lets create the util_exception_query function
CREATE OR REPLACE FUNCTION util_exception_query(text)
  RETURNS SETOF text AS
$func$
DECLARE
    text_msg text;
    text_detail text;
    text_hint text;
BEGIN
    EXECUTE $1;
EXCEPTION WHEN OTHERS THEN
    GET STACKED DIAGNOSTICS text_msg    = MESSAGE_TEXT,
                            text_detail = PG_EXCEPTION_DETAIL,
                            text_hint   = PG_EXCEPTION_HINT;
    RETURN NEXT text_msg;
END
$func$ LANGUAGE plpgsql;
--- end

-- lets confirm that delete works
DELETE FROM locations WHERE id = '0006b3dc-mosh-420e-970b-5b69597d80b2';

-- the record should be removed from structure_geo_hierarchy_structure_queue
SELECT 1/COUNT(*)
FROM util_exception_query(
$$
SELECT 1/COUNT(*) FROM structure_geo_hierarchy_structure_queue
WHERE structure_id = '0006b3dc-mosh-420e-970b-5b69597d80b2';
$$) AS output
WHERE output ILIKE '%division by zero%';

DELETE FROM locations WHERE id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb';

-- the record should be removed from structure_geo_hierarchy_structure_queue
SELECT 1/COUNT(*)
FROM util_exception_query(
$$
SELECT 1/COUNT(*) FROM structure_geo_hierarchy_structure_queue
WHERE structure_id = '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb';
$$) AS output
WHERE output ILIKE '%division by zero%';

-- lets confirm that bulk delete works

-- first insert
INSERT INTO locations
VALUES (
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    NOW(),
    '8405b2e8-6feb-4f85-bcff-b3cb5aa57ce3',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Residential Structure',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Pending Review',
    ST_GeomFromGeoJSON('{"type":"Point","coordinates":[31.7841588,-14.3052436]}'),
    0,
    NULL,
    NULL,
    0,
    1572378324112
);

INSERT INTO locations
VALUES (
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    NOW(),
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '622574979',
    'Active',
    ST_GeomFromGeoJSON('{"type":"Polygon","coordinates":[[[31.8008263001936,-14.3355217001663,0],[31.8008654000183,-14.3355284001155,0],[31.8008567998015,-14.3355756001338,0],[31.8008176999769,-14.3355690000093,0],[31.8008263001936,-14.3355217001663,0]]]}'),
    5,
    NULL,
    NULL,
    0,
    1570473981872
);

INSERT INTO structure_geo_hierarchy_structure_queue
VALUES
(uuid_generate_v1(), '0006b3dc-mosh-420e-970b-5b69597d80b2'),
(uuid_generate_v1(), '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb');

-- bulk delete locations
DELETE FROM locations;

-- we should have no records in structure_geo_hierarchy_structure_queue
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_structure_queue) AS foo
WHERE count = 0;  -- we now have zero records

-- lets confirm that TRUNCATE works

-- first insert
INSERT INTO locations
VALUES (
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    NOW(),
    '8405b2e8-6feb-4f85-bcff-b3cb5aa57ce3',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Residential Structure',
    '0006b3dc-mosh-420e-970b-5b69597d80b2',
    'Pending Review',
    ST_GeomFromGeoJSON('{"type":"Point","coordinates":[31.7841588,-14.3052436]}'),
    0,
    NULL,
    NULL,
    0,
    1572378324112
);

INSERT INTO locations
VALUES (
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    NOW(),
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    'acdde6e5-mosh-49a9-a141-424a5862a5af',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb',
    '622574979',
    'Active',
    ST_GeomFromGeoJSON('{"type":"Polygon","coordinates":[[[31.8008263001936,-14.3355217001663,0],[31.8008654000183,-14.3355284001155,0],[31.8008567998015,-14.3355756001338,0],[31.8008176999769,-14.3355690000093,0],[31.8008263001936,-14.3355217001663,0]]]}'),
    5,
    NULL,
    NULL,
    0,
    1570473981872
);

INSERT INTO structure_geo_hierarchy_structure_queue
VALUES
(uuid_generate_v1(), '0006b3dc-mosh-420e-970b-5b69597d80b2'),
(uuid_generate_v1(), '023bd6d7-mosh-4194-907a-2f5c3bfcf4bb');

-- truncate locations
TRUNCATE locations CASCADE;

-- we should have no records in structure_geo_hierarchy_structure_queue
SELECT 1/COUNT(*)
FROM (SELECT count(*) FROM structure_geo_hierarchy_structure_queue) AS foo
WHERE count = 0;  -- we now have zero records


ROLLBACK;